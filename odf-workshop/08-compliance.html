<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Compliance Operator and Compliance in ACS :: ODF Workshop</title>
    <link rel="canonical" href="https://tutsunom.github.io/odf-workshop/odf-workshop/08-compliance.html">
    <link rel="prev" href="07-violations.html">
    <link rel="next" href="09-configuration_management.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://tutsunom.github.io/odf-workshop">ODF Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="odf-workshop" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">ODF Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#01-setup.adoc">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#01-setup.adoc#prerequisite">Prerequisites</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#02-getting_started.adoc">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#install_acs_operator">Install RHACS Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#install_acs_central">Install RHACS Central Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#config_acs_securedcluster">Configuration of the RHACS Secured Cluster </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#deploy_demo_acs">Deploying Demo in RHACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#deploy_apps">Deploying Apps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#03-overview-acs.adoc">RHACS Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#03-overview-acs.adoc#acs_architecture">RHACS Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs">RHACS Dashboard</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs_header">Dashboard Header</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs_menu">Dashboard Left Menu</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs_information">Dashboard Information</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-vulnerabilities.html">Vulnerability Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-vulnerabilities.html#image_overview_image_details">Image overview and image details</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-vulnerabilities.html#vulnerability_management_panel">Review Vulnerability Management Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-vulnerabilities.html#scanning_images">Scanning images for vulnerabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-vulnerabilities.html#filtering_vulnerabilities_scans">Filtering vulnerabilities scans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-vulnerabilities.html#review_cve_images">Image CVE Vulnerability Analysis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-vulnerabilities.html#image_correlation_deployments">Image CVE correlation with Deployments</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-risk.html">Risk Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-risk.html#risk_dashboard">Review Risk Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-risk.html#risk_single_deployment_details">Single Deployment Details</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-risk.html#risk_process_discovery">Process Discovery / Runtime</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-risk.html#risk_filtering">Filtering</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-network_graph.html">Network Graph</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-network_graph.html#network_graph_overview">Network Graph Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-network_graph.html#network_graph_views">Network Graph Views</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-network_graph.html#network_policy_simulator">Network Policy Simulator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="07-violations.html">Violations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-violations.html#violations_overview">Violations Dashboard Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-violations.html#violations_example">Violations Build &amp; Deploy Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-violations.html#violations_runtime">Violations Runtime Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-violations.html#violations_behaviour">Violations Behaviour</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-violations.html#policy_summary">Policy Summary</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="08-compliance.html">Compliance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#compliance_dashboard">Review Compliance Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#compliance_dashboard_scan">Execute the first Compliance Scan</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#compliance_dashboard_review">Review the Compliance Reports in the Compliance Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#compliance_dashboard_ns">Namespace Compliance Details</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#compliance_dashboard_report">Evidence Export</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#compliance_operator">Integrating Compliance Operator with RHACS </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#compliance_operator_acs_review">Review Compliance Scans of the Compliance Operator in RHACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#acs_policy_compliance">Configure Policy in RHACS to Invoke Compliance related Controls</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#acs_policy_compliance_nist">Enforce Policies that Meet Guidance for NIST Control 4.2.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#acs_policy_compliance_nist_view">View Updated Compliance Scan Results in RHACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#acs_policy_compliance_nist_revert">Revert the Policy Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="09-configuration_management.html">Configuration Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-configuration_management.html#conf_management_overview">Configuration Management Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-configuration_management.html#conf_management_cis">Configuration Management CIS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="10-system_policies.html">System Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-system_policies.html#system_policies_overview">System Policies Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-system_policies.html#system_policies_example">System Policies Build and Deploy Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-system_policies.html#system_policies_enforcement">System Policies Enforcement</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="11-integrations.html">RHACS Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="11-integrations.html#integrate_with_internal_openshift_registry">Integrate with Internal Openshift Registry</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="11-integrations.html#integrate_with_internal_openshift_registry_config_acs">Configure RHACS integration for Internal Openshift Registry</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-integrations.html#integrate_acs_slack">Integrate RHACS with Slack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-integrations.html#integrate_acs_oauth">Integrate RHACS with OpenShift OAuth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-integrations.html#integrate_acs_sso">Integrate RHACS with OpenShift RHSSO</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="12-platform_configuration.html">RHACS Secure Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-platform_configuration.html#system_configuration">RHACS System Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-platform_configuration.html#system_health">RHACS System Health</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-platform_configuration.html#access_control">RHACS Access Control</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="14-cicd-jp.html">RHACSを使用したアプリケーションへの自動化セキュリティの実装とDevSecOpsの構築</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#setup">セットアップ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#ci">継続的インテグレーション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#devsecops">ACSを利用したDevSecOpsのステップ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#cd">GitOpsを使った継続的デリバリー</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#dast">PostCI - ダイナミックアプリケーションセキュリティとテスト (DAST)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#policy_violation">セキュリティポリシーとCI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#fiximage">ボーナスラボ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-cicd-jp.html#troubleshooting">トラブルシューティング</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="15-contributors.html">Contributors</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ODF Workshop</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ODF Workshop</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">ODF Workshop</a></li>
    <li><a href="08-compliance.html">Compliance</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/tutsunom/odf-workshop/edit/master/documentation/modules/ROOT/pages/08-compliance.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Compliance Operator and Compliance in ACS</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The OpenShift Compliance Operator allows OpenShift Container Platform administrators to define the desired compliance state of a cluster and provides an overview of gaps and ways to remediate any non-compliant policy.</p>
</div>
<div class="paragraph">
<p>The OpenShift Compliance Operator assesses both Kubernetes API resources and OpenShift Container Platform resources, as well as the nodes running the cluster. The Compliance Operator uses OpenSCAP, a NIST-certified tool, to scan and enforce security policies provided by the content.</p>
</div>
<div class="paragraph">
<p>Red Hat Advanced Cluster Security for Kubernetes supports OpenShift Container Platform configuration compliance standards through an integration with the OpenShift Container Platform Compliance Operator. In addition, it allows you to measure and report on configuration security best practices for OpenShift Container Platform.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compliance_dashboard"><a class="anchor" href="#compliance_dashboard"></a>Review Compliance Dashboard</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="compliance_dashboard_scan"><a class="anchor" href="#compliance_dashboard_scan"></a>Execute the first Compliance Scan</h3>
<div class="paragraph">
<p>Once the RHACS is installed the first compliance scan needs to be executed to ensure that the Compliance results are available. So let&#8217;s execute our first Compliance Scan.</p>
</div>
<div class="paragraph">
<p>Compliance Dashboard without the First Compliance Scan</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/00_compliance_dash.png" alt="ACS 1" width="800">
</div>
</div>
<div class="paragraph">
<p>Run compliance scanner</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/01_compliance_scan.png" alt="ACS 2" width="300">
</div>
</div>
<div class="paragraph">
<p>Compliance Result</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/02_compliance_result.png" alt="ACS 3" width="800">
</div>
</div>
<div class="paragraph">
<p>TODO: Add more descriptions in compliance dashboard scan</p>
</div>
</div>
<div class="sect2">
<h3 id="compliance_dashboard_review"><a class="anchor" href="#compliance_dashboard_review"></a>Review the Compliance Reports in the Compliance Dashboard</h3>
<div class="paragraph">
<p>The compliance reports gather information for configuration, industry standards, and best practices for container-based workloads running in OpenShift.</p>
</div>
<div class="paragraph">
<p>In many ways, you’ve already seen the compliance features - because they’re tied to controls that we saw in Risk, in the Network Graph, and in Policies</p>
</div>
<div class="paragraph">
<p>Each standard represents a series of controls, with guidance provided by StackRox on the specific OpenShift configuration or DevOps process required to meet that control.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on PCI, or the PCI percentage bar, in the upper-left “Passing Standards Across Clusters” graph</p>
</li>
<li>
<p>Click on Control 1.1.4, “Requirements for a firewall…”</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/00_compliance_pci.png" alt="ACS 4" width="800">
</div>
</div>
<div class="paragraph">
<p>For example, PCI-DSS has controls that refer to firewalls and DMZ - not exactly cloud-native</p>
</div>
<div class="paragraph">
<p>In OpenShift, that requirement, and other isolation requirements, is met by Network Policies, and the 32% compliance score here indicates that only about one third of my deployments have correctly defined policies.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on Compliance tab from the left hand side menu</p>
</li>
<li>
<p>Click on NIST SP 800-190. Click on Control 4.1.1, “Image vulnerabilities…”</p>
</li>
<li>
<p>Similarly - NIST 800-190, the application containers security standard, requires a pipeline-based build approach to mitigating vulnerabilities in images.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/00_compliance_pci2.png" alt="ACS 4_2" width="800">
</div>
</div>
<div class="paragraph">
<p>Because we added enforcement to the CVSS &gt;7 policy, we now meet the requirement dictated by control 4.1.1, and the 0% score changes to 100% because we now have the control in place to prevent known vulnerabilities from being deployed</p>
</div>
</div>
<div class="sect2">
<h3 id="compliance_dashboard_ns"><a class="anchor" href="#compliance_dashboard_ns"></a>Namespace Compliance Details</h3>
<div class="ulist">
<ul>
<li>
<p>Click on Compliance tab on the left hand side menu</p>
</li>
<li>
<p>Click on Namespaces in the top toolbar of the compliance page</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, like every other report - it’s also valuable to break this data down by Clusters, Namespaces, and Deployments.</p>
</div>
<div class="paragraph">
<p>Namespaces in particular - being able to see, application-by-application, or team-by-team, where the gaps in compliance are.</p>
</div>
</div>
<div class="sect2">
<h3 id="compliance_dashboard_report"><a class="anchor" href="#compliance_dashboard_report"></a>Evidence Export</h3>
<div class="ulist">
<ul>
<li>
<p>Click on Compliance tab on the left hand side menu</p>
</li>
<li>
<p>Last thing about compliance - you’re only as compliant as you can prove!</p>
</li>
<li>
<p>Click on the Export button in the upper right to show the “Evidence as CSV” option</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the evidence export that your auditors will want to see for proof that the security controls mandated are actually in place.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compliance_operator"><a class="anchor" href="#compliance_operator"></a>Integrating the OpenShift Compliance Operator with ACS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Advanced Cluster Security for Kubernetes supports OpenShift Container Platform configuration compliance standards through an integration with the OpenShift Container Platform Compliance Operator.</p>
</div>
<div class="paragraph">
<p>Follow the next steps to install and integrate the Compliance Operator with Advanced Cluster Security.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to your <code>TUTORIAL_HOME</code> directory:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a Namespace object YAML file by running:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f labitem/co-ns.yaml</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apiVersion: v1
kind: Namespace
metadata:
  name: openshift-compliance</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the Compliance Operator OperatorGroup object YAML file by running:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f labitem/co-og.yaml</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: compliance-operator
  namespace: openshift-compliance
spec:
  targetNamespaces:
  - openshift-compliance</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the Compliance Operator Subscription object YAML file by running:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f labitem/co-subs.yaml</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: compliance-operator-sub
  namespace: openshift-compliance
spec:
  channel: "release-0.1"
  installPlanApproval: Automatic
  name: compliance-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify the installation succeeded by inspecting the CSV file:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get csv -n openshift-compliance | grep compliance</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get csv -n openshift-compliance | grep compliance
compliance-operator.v0.1.57   Compliance Operator   0.1.57   Succeeded</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify that the Compliance Operator is up and running:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pod -n openshift-compliance</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pod -n openshift-compliance
NAME                                            READY   STATUS    RESTARTS   AGE
compliance-operator-5989ff994b-mrhc9            1/1     Running   1          4m42s
ocp4-openshift-compliance-pp-6d7c7db4bd-2gnrf   1/1     Running   0          3m2s
rhcos4-openshift-compliance-pp-c7b548bd-k4sz2   1/1     Running   0          3m2s</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="compliance_operator_scan"><a class="anchor" href="#compliance_operator_scan"></a>Running compliance scans</h3>
<div class="paragraph">
<p>We now want to make sure that the nodes are scanned appropiately. For this, we’ll need a ScanSettingsBinding, this bind a profile with scan settings in order to get scans to run.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a ScanSettingBinding object that binds to the default ScanSetting object and scans the cluster using the cis and cis-node profiles.</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f labitem/co-scan.yaml</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apiVersion: compliance.openshift.io/v1alpha1
kind: ScanSettingBinding
metadata:
  name: cis-scan
  namespace: openshift-compliance
profiles:
- apiGroup: compliance.openshift.io/v1alpha1
  kind: Profile
  name: ocp4-cis
settingsRef:
  apiGroup: compliance.openshift.io/v1alpha1
  kind: ScanSetting
  name: default</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the scansettingbinding generated:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get scansettingbinding cis-scan -n openshift-compliance -o yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>With this the scan will start as you can check with the CRD of ComplianceScan.</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get compliancescan -n openshift-compliance ocp4-cis</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> oc get compliancescan -n openshift-compliance
NAME       PHASE     RESULT
ocp4-cis   RUNNING   NOT-AVAILABLE</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>After the scan is done, you&#8217;ll see it was persistent in the relevant namespace:</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get compliancescan -n openshift-compliance</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME       PHASE   RESULT
ocp4-cis   DONE    NON-COMPLIANT</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compliance_operator_acs_review"><a class="anchor" href="#compliance_operator_acs_review"></a>Review Compliance Scans of the Compliance Operator in RHACS</h3>
<div class="paragraph">
<p>After completing the previous steps, you will be able to find the results from the Compliance Operator compliance reports in RHACS.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If RHACS was installed prior to the Compliance Operator, we&#8217;ll need to restart the ACS sensor in the OpenShift cluster to see these results.</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete pods -l app.kubernetes.io/component=sensor -n stackrox</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>With the Sensor restarted, kick off a compliance scan in ACS to see the updated results:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/01_compliance_scan.png" alt="ACS 4" width="300">
</div>
</div>
<div class="paragraph">
<p>In the ACS User Interface, select Compliance from the left menu, and click Scan Environment in the top menu bar.
The scan should only take a few seconds; once it&#8217;s complete you should see entries for both the ACS built-in and compliance operator standards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check that the ocp4-cis report from the Compliance Operator is shown in ACS Compliance Dashboard:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/03_compliance_operator_in_acs.png" alt="ACS 5" width="500">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To see the detailed results, click on the name or bar of any of the standards. To investigate the results of the OpenShift CIS benchmark scan, for example, click ocp4-cis:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/04_co_acs_detail.png" alt="ACS 6" width="800">
</div>
</div>
<div class="paragraph">
<p>For more information check the <a href="https://docs.openshift.com/container-platform/4.8/security/compliance_operator/compliance-scans.html">Compliance Operator guide</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="acs_policy_compliance"><a class="anchor" href="#acs_policy_compliance"></a>Configure Policy in RHACS to Invoke Compliance related Controls</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Built-in standards in RHACS Compliance provide guidance on required configurations to meet each individual control. Standards like PCI, HIPAA, and NIST 800-190 are focused on workloads visible to RHACS, and apply to all workloads running in any Kubernetes cluster that RHACS is installed in.</p>
</div>
<div class="paragraph">
<p>Much of the control guidance can be implemented using RHACS policies, and providing appropriate policy with enforcement in RHACS can change compliance scores.</p>
</div>
<div class="paragraph">
<p>As an example, we&#8217;ll look at a control in the NIST 800-190 that requires that container images be kept up to date, and to use meaningful version tags: "practices should emphasize accessing images using immutable names that specify discrete versions of images to be used."</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This configuration will change the behavior of your Kubernetes clusters and possibly result in preventing new deployments from being created. After testing, you can quickly revert the changes using the instructions at the end of this section.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Inspect the NIST 800-190 Guidance for Control 4.2.2</p>
</li>
<li>
<p>Navigate back to the RHACS Compliance page.</p>
</li>
<li>
<p>In the section labeled "PASSING STANDARDS ACROSS CLUSTERS", click on NIST 800-190.</p>
</li>
<li>
<p>Scroll down to control 4.2.2 and examine the control guidance on the right.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The control guidance reads:
"StackRox continuously monitors the images being used by active deployments. StackRox provides
built-in policies that detects if images with insecure tags are being used or if the image being used is pretty old.
Therefore, the cluster is compliant if there are policies that are being enforced that discourages such images from being
deployed."</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/05_nist0.png" alt="RHACS 7" width="700">
</div>
</div>
<div class="sect2">
<h3 id="acs_policy_compliance_nist"><a class="anchor" href="#acs_policy_compliance_nist"></a>Enforce Policies that Meet Guidance for NIST Control 4.2.2</h3>
<div class="paragraph">
<p>There are two separate default system policies that, together, meet this control&#8217;s guidance, "90-day Image Age," and "Latest tag". Both must have enforcement enabled for this control to be satisfied.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to Platform Configuration &#8594; Policies</p>
</li>
<li>
<p>Find and click on the policy named, "90-day Image Age" which by default is second in the list. We&#8217;re not going to change this policy other than to enable enforcement.</p>
</li>
<li>
<p>Click Actions &#8594; Edit Policy to get to the Policy settings.</p>
</li>
<li>
<p>Click Next at the bottom panel to get to the Policy Behavior page.</p>
</li>
<li>
<p>On the response method options, click "Inform and enforce".</p>
</li>
<li>
<p>Toggle on for both "Build" and "Deploy" enforcement.</p>
</li>
<li>
<p>Click Next at the bottom panel until you get to Review Policy page.</p>
</li>
<li>
<p>Click Save.</p>
</li>
<li>
<p>At the main Policies page, find the Policy named, "Latest tag" and repeat steps 3 - 6 to enable enforcement and save the policy.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/06_nist1.png" alt="RHACS 8" width="400">
</div>
</div>
</div>
<div class="sect2">
<h3 id="acs_policy_compliance_nist_view"><a class="anchor" href="#acs_policy_compliance_nist_view"></a>View Updated Compliance Scan Results in RHACS</h3>
<div class="ulist">
<ul>
<li>
<p>In order to see the impact on NIST 800-190 scores:</p>
</li>
<li>
<p>Navigate back to the compliance page.</p>
</li>
<li>
<p>Click "Scan Environment" in the upper right.</p>
</li>
<li>
<p>In the section labeled "PASSING STANDARDS ACROSS CLUSTERS", click on NIST 800-190.</p>
</li>
<li>
<p>Scroll down to control 4.2.2 and verify that the control now reports 100% compliance.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/compliance/07_nist2.png" alt="RHACS 9" width="700">
</div>
</div>
</div>
<div class="sect2">
<h3 id="acs_policy_compliance_nist_revert"><a class="anchor" href="#acs_policy_compliance_nist_revert"></a>Revert the Policy Changes</h3>
<div class="paragraph">
<p>To avoid rejecting any other deployments to the cluster, you should disable the enforcement after viewing the updated RHACS results.</p>
</div>
<div class="paragraph">
<p>Navigate to Platform Configuration &#8594; Policies
Find and click on the policy named, "90-day Image Age" which by default is second in the list. Click Edit to get to the Policy settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click Actions &#8594; Edit Policy to get to the Policy settings.</p>
</li>
<li>
<p>Click Next at the bottom panel to get to the Policy Behavior page.</p>
</li>
<li>
<p>On the response method options, click "Inform".</p>
</li>
<li>
<p>Click Next at the bottom panel until you get to Review Policy page.</p>
</li>
<li>
<p>Click Save.</p>
</li>
<li>
<p>At the main Policies page, find the Policy named, "Latest tag" and repeat the steps to disable enforcement and save the policy.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="07-violations.html">Violations</a></span>
  <span class="next"><a href="09-configuration_management.html">Configuration Management</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
