<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Multi-Cloud Gateway :: ODF Workshop</title>
    <link rel="canonical" href="https://tutsunom.github.io/odf-workshop/odf-workshop/06-mcg.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://tutsunom.github.io/odf-workshop">ODF Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="odf-workshop" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">ODF Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#01-setup.adoc">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#01-setup.adoc#prerequisite">Prerequisites</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#02-getting_started.adoc">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#install_acs_operator">Install RHACS Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#install_acs_central">Install RHACS Central Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#config_acs_securedcluster">Configuration of the RHACS Secured Cluster </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#deploy_demo_acs">Deploying Demo in RHACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-getting_started.adoc#deploy_apps">Deploying Apps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#03-overview-acs.adoc">RHACS Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#03-overview-acs.adoc#acs_architecture">RHACS Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs">RHACS Dashboard</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs_header">Dashboard Header</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs_menu">Dashboard Left Menu</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#03-overview-acs.adoc#dashboard_acs_information">Dashboard Information</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#04-vulnerabilities.adoc">Vulnerability Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-vulnerabilities.adoc#image_overview_image_details">Image overview and image details</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-vulnerabilities.adoc#vulnerability_management_panel">Review Vulnerability Management Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-vulnerabilities.adoc#scanning_images">Scanning images for vulnerabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-vulnerabilities.adoc#filtering_vulnerabilities_scans">Filtering vulnerabilities scans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-vulnerabilities.adoc#review_cve_images">Image CVE Vulnerability Analysis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-vulnerabilities.adoc#image_correlation_deployments">Image CVE correlation with Deployments</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#05-risk.adoc">Risk Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#05-risk.adoc#risk_dashboard">Review Risk Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#05-risk.adoc#risk_single_deployment_details">Single Deployment Details</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#05-risk.adoc#risk_process_discovery">Process Discovery / Runtime</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#05-risk.adoc#risk_filtering">Filtering</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#06-network_graph.adoc">Network Graph</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#06-network_graph.adoc#network_graph_overview">Network Graph Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#06-network_graph.adoc#network_graph_views">Network Graph Views</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#06-network_graph.adoc#network_policy_simulator">Network Policy Simulator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#07-violations.adoc">Violations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#07-violations.adoc#violations_overview">Violations Dashboard Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#07-violations.adoc#violations_example">Violations Build &amp; Deploy Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#07-violations.adoc#violations_runtime">Violations Runtime Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#07-violations.adoc#violations_behaviour">Violations Behaviour</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#07-violations.adoc#policy_summary">Policy Summary</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#08-compliance.adoc">Compliance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#compliance_dashboard">Review Compliance Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#compliance_dashboard_scan">Execute the first Compliance Scan</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#compliance_dashboard_review">Review the Compliance Reports in the Compliance Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#compliance_dashboard_ns">Namespace Compliance Details</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#compliance_dashboard_report">Evidence Export</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#compliance_operator">Integrating Compliance Operator with RHACS </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#compliance_operator_acs_review">Review Compliance Scans of the Compliance Operator in RHACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#acs_policy_compliance">Configure Policy in RHACS to Invoke Compliance related Controls</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#acs_policy_compliance_nist">Enforce Policies that Meet Guidance for NIST Control 4.2.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#acs_policy_compliance_nist_view">View Updated Compliance Scan Results in RHACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#08-compliance.adoc#acs_policy_compliance_nist_revert">Revert the Policy Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#09-configuration_management.adoc">Configuration Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#09-configuration_management.adoc#conf_management_overview">Configuration Management Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#09-configuration_management.adoc#conf_management_cis">Configuration Management CIS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#10-system_policies.adoc">System Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#10-system_policies.adoc#system_policies_overview">System Policies Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#10-system_policies.adoc#system_policies_example">System Policies Build and Deploy Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#10-system_policies.adoc#system_policies_enforcement">System Policies Enforcement</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#11-integrations.adoc">RHACS Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#11-integrations.adoc#integrate_with_internal_openshift_registry">Integrate with Internal Openshift Registry</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#11-integrations.adoc#integrate_with_internal_openshift_registry_config_acs">Configure RHACS integration for Internal Openshift Registry</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#11-integrations.adoc#integrate_acs_slack">Integrate RHACS with Slack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#11-integrations.adoc#integrate_acs_oauth">Integrate RHACS with OpenShift OAuth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#11-integrations.adoc#integrate_acs_sso">Integrate RHACS with OpenShift RHSSO</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#12-platform_configuration.adoc">RHACS Secure Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#12-platform_configuration.adoc#system_configuration">RHACS System Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#12-platform_configuration.adoc#system_health">RHACS System Health</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#12-platform_configuration.adoc#access_control">RHACS Access Control</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#14-cicd-jp.adoc">RHACSを使用したアプリケーションへの自動化セキュリティの実装とDevSecOpsの構築</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#setup">セットアップ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#ci">継続的インテグレーション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#devsecops">ACSを利用したDevSecOpsのステップ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#cd">GitOpsを使った継続的デリバリー</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#dast">PostCI - ダイナミックアプリケーションセキュリティとテスト (DAST)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#policy_violation">セキュリティポリシーとCI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#fiximage">ボーナスラボ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#14-cicd-jp.adoc#troubleshooting">トラブルシューティング</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#15-contributors.adoc">Contributors</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ODF Workshop</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ODF Workshop</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">ODF Workshop</a></li>
    <li><a href="06-mcg.html">Multi-Cloud Gateway</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/tutsunom/odf-workshop/edit/master/documentation/modules/ROOT/pages/06-mcg.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Multi-Cloud Gateway</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このセクションでは、オブジェクトバケットを使用するアプリケーションをデプロイします。アプリケーションは、<code>Multi-Cloud Gateway (MCG)</code> を介して <strong>ObjectBucketClaim (OBC)</strong> というリソースを使うことで、動的にオブジェクトバケットを獲得します。<br>
また、<code>MCG Console</code> を使って <strong>Object Bucket (OB)</strong> に正しくオブジェクトが置かれていることを確認します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>MCG Console</code> は <strong>Openshift Web Console</strong> とは完全に統合されていません。そのため <code>MCG Console</code> を使って作成したリソースは、OpenShift クラスタに反映されません。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_noobaa_cliのインストール"><a class="anchor" href="#_noobaa_cliのインストール"></a>NooBaa CLIのインストール</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MCGは <code>MCG Console</code> と <strong>Openshift Web Console</strong> の他にも、CLIが用意されています。<br>
CLIをインストールすると、<code>noobaa</code> コマンドが実行できるようになります。</p>
</div>
<div class="paragraph">
<p>MCG CLIはODFのサブスクリプションがあればアクセスできるソフトウェアリポジトリから、RHELにインストールできます。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo subscription-manager repos --enable=rh-odf-4-for-rhel-8-x86_64-rpms
sudo dnf install -y mcg</code></pre>
</div>
</div>
<div class="paragraph">
<p>もしMCG CLIをインストールできない場合は、OSSのNooBaa CLIをインストールしましょう。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">OS="linux"
VERSION=$(curl -s <a href="https://api.github.com/repos/noobaa/noobaa-operator/releases/latest" class="bare">https://api.github.com/repos/noobaa/noobaa-operator/releases/latest</a> | jq -r '.name')
curl -LO <a href="https://github.com/noobaa/noobaa-operator/releases/download/$VERSION/noobaa-$OS-$VERSION" class="bare">https://github.com/noobaa/noobaa-operator/releases/download/$VERSION/noobaa-$OS-$VERSION</a>
chmod +x noobaa-$OS-$VERSION
sudo mv noobaa-$OS-$VERSION /usr/local/bin/noobaa</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
OSSのNooBaa CLIはODFのサブスクリプションサポートの範囲外です。サポートを希望する場合は、MCG CLIを使いましょう。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>いずれかのCLIがインストールできたら、<code>noobaa</code> コマンドで確認します。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">noobaa version</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">noobaa version
INFO[0000] CLI version: 5.9.0
INFO[0000] noobaa-image: noobaa/noobaa-core:5.9.0
INFO[0000] operator-image: noobaa/noobaa-operator:5.9.0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mcgのステータス確認"><a class="anchor" href="#_mcgのステータス確認"></a>MCGのステータス確認</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MCGのステータスを <code>noobaa</code> コマンドで確認します。<code>openshift-storage</code> Namespaceを指定して、次のコマンドを実行します。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">noobaa status -n openshift-storage</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">INFO[0000] CLI version: 5.9.0
INFO[0000] noobaa-image: registry.redhat.io/odf4/mcg-core-rhel8@sha256:a6614c8fe182ba2c39ddb3aaa0f5a37bd392cc5d69bdbf05c7e96125ee3535a2
INFO[0000] operator-image: registry.redhat.io/odf4/mcg-rhel8-operator@sha256:e535691f95556959dd61b651e0ab8afae82b67fae0ddf2284615b1502b93a108
INFO[0000] noobaa-db-image: registry.redhat.io/rhel8/postgresql-12@sha256:fa920188f567e51d75aacd723f0964026e42ac060fed392036e8d4b3c7a8129f
INFO[0000] Namespace: openshift-storage
INFO[0000]
INFO[0000] CRD Status:
INFO[0000] ✅ Exists: CustomResourceDefinition "noobaas.noobaa.io"
INFO[0000] ✅ Exists: CustomResourceDefinition "backingstores.noobaa.io"
INFO[0000] ✅ Exists: CustomResourceDefinition "namespacestores.noobaa.io"
INFO[0000] ✅ Exists: CustomResourceDefinition "bucketclasses.noobaa.io"
INFO[0000] ✅ Exists: CustomResourceDefinition "objectbucketclaims.objectbucket.io"
INFO[0000] ✅ Exists: CustomResourceDefinition "objectbuckets.objectbucket.io"
INFO[0000]
INFO[0000] Operator Status:
INFO[0000] ✅ Exists: Namespace "openshift-storage"
INFO[0000] ✅ Exists: ServiceAccount "noobaa"
INFO[0000] ✅ Exists: ServiceAccount "noobaa-endpoint"
INFO[0000] ✅ Exists: Role "mcg-operator.v4.9.8-noobaa-79b477964"
INFO[0000] ✅ Exists: Role "mcg-operator.v4.9.8-noobaa-endpoint-6bfd8f48c7"
INFO[0000] ✅ Exists: RoleBinding "mcg-operator.v4.9.8-noobaa-79b477964"
INFO[0000] ✅ Exists: RoleBinding "mcg-operator.v4.9.8-noobaa-endpoint-6bfd8f48c7"
INFO[0000] ✅ Exists: ClusterRole "mcg-operator.v4.9.8-f46845887"
INFO[0000] ✅ Exists: ClusterRoleBinding "mcg-operator.v4.9.8-f46845887"
INFO[0000] ✅ Exists: Deployment "noobaa-operator"
INFO[0000]
INFO[0000] System Wait Ready:
INFO[0000] ✅ System Phase is "Ready".
INFO[0000]
INFO[0000]
INFO[0000] System Status:
INFO[0000] ✅ Exists: NooBaa "noobaa"
INFO[0000] ✅ Exists: StatefulSet "noobaa-core"
INFO[0000] ✅ Exists: ConfigMap "noobaa-config"
INFO[0000] ✅ Exists: Service "noobaa-mgmt"
INFO[0000] ✅ Exists: Service "s3"
INFO[0000] ✅ Exists: Secret "noobaa-db"
INFO[0000] ✅ Exists: ConfigMap "noobaa-postgres-config"
INFO[0000] ✅ Exists: ConfigMap "noobaa-postgres-initdb-sh"
INFO[0000] ✅ Exists: StatefulSet "noobaa-db-pg"
INFO[0000] ✅ Exists: Service "noobaa-db-pg"
INFO[0000] ✅ Exists: Secret "noobaa-server"
INFO[0000] ✅ Exists: Secret "noobaa-operator"
INFO[0000] ✅ Exists: Secret "noobaa-endpoints"
INFO[0000] ✅ Exists: Secret "noobaa-admin"
INFO[0000] ✅ Exists: Secret "noobaa-root-master-key"
INFO[0000] ✅ Exists: StorageClass "openshift-storage.noobaa.io"
INFO[0000] ✅ Exists: BucketClass "noobaa-default-bucket-class"
INFO[0000] ✅ Exists: Deployment "noobaa-endpoint"
INFO[0000] ✅ Exists: HorizontalPodAutoscaler "noobaa-endpoint"
INFO[0000] ✅ (Optional) Exists: BackingStore "noobaa-default-backing-store"
INFO[0000] ✅ (Optional) Exists: CredentialsRequest "noobaa-aws-cloud-creds"
INFO[0000] ⬛ (Optional) Not Found: CredentialsRequest "noobaa-azure-cloud-creds"
INFO[0000] ⬛ (Optional) Not Found: Secret "noobaa-azure-container-creds"
INFO[0000] ⬛ (Optional) Not Found: Secret "noobaa-gcp-bucket-creds"
INFO[0000] ⬛ (Optional) Not Found: CredentialsRequest "noobaa-gcp-cloud-creds"
INFO[0000] ✅ (Optional) Exists: PrometheusRule "noobaa-prometheus-rules"
INFO[0000] ✅ (Optional) Exists: ServiceMonitor "noobaa-mgmt-service-monitor"
INFO[0000] ✅ (Optional) Exists: ServiceMonitor "s3-service-monitor"
INFO[0000] ✅ (Optional) Exists: Route "noobaa-mgmt"
INFO[0000] ✅ (Optional) Exists: Route "s3"
INFO[0000] ✅ Exists: PersistentVolumeClaim "db-noobaa-db-pg-0"
INFO[0000] ✅ System Phase is "Ready"
INFO[0000] ✅ Exists:  "noobaa-admin"

#------------------#
#- Mgmt Addresses -#
#------------------#

ExternalDNS : [<a href="https://noobaa-mgmt-openshift-storage.apps.cluster-d6qlm.d6qlm.sandbox458.opentlc.com" class="bare">https://noobaa-mgmt-openshift-storage.apps.cluster-d6qlm.d6qlm.sandbox458.opentlc.com</a> <a href="https://ab1768603a7e3435a9a5eef23dd385bb-1738493587" class="bare">https://ab1768603a7e3435a9a5eef23dd385bb-1738493587</a>.
us-east-2.elb.amazonaws.com:443]
ExternalIP  : []
NodePorts   : [<a href="https://10.0.219.73:31910" class="bare">https://10.0.219.73:31910</a>]
InternalDNS : [<a href="https://noobaa-mgmt.openshift-storage.svc:443" class="bare">https://noobaa-mgmt.openshift-storage.svc:443</a>]
InternalIP  : [<a href="https://172.30.112.229:443" class="bare">https://172.30.112.229:443</a>]
PodPorts    : [<a href="https://10.131.2.19:8443" class="bare">https://10.131.2.19:8443</a>]

#--------------------#
#- Mgmt Credentials -#
#--------------------#

email    : <a href="mailto:admin@noobaa.io">admin@noobaa.io</a>
password : +tymeanDJtTZkhhMQuKezQ==

#----------------#
#- S3 Addresses -#
#----------------#

ExternalDNS : [<a href="https://s3-openshift-storage.apps.cluster-d6qlm.d6qlm.sandbox458.opentlc.com" class="bare">https://s3-openshift-storage.apps.cluster-d6qlm.d6qlm.sandbox458.opentlc.com</a> <a href="https://aba4c23b3771e4d0b8e84b4134d0e34f-1563330099.us-east-2" class="bare">https://aba4c23b3771e4d0b8e84b4134d0e34f-1563330099.us-east-2</a>
.elb.amazonaws.com:443]
ExternalIP  : []
NodePorts   : [<a href="https://10.0.219.73:30906" class="bare">https://10.0.219.73:30906</a>]
InternalDNS : [<a href="https://s3.openshift-storage.svc:443" class="bare">https://s3.openshift-storage.svc:443</a>]
InternalIP  : [<a href="https://172.30.72.123:443" class="bare">https://172.30.72.123:443</a>]
PodPorts    : [<a href="https://10.131.2.21:6443" class="bare">https://10.131.2.21:6443</a>]

#------------------#
#- S3 Credentials -#
#------------------#

AWS_ACCESS_KEY_ID     : Q4dCJr2hKLpEX4GAWH9q
AWS_SECRET_ACCESS_KEY : OqtAermCqSmHTe9agjlNo/Tgj8MldpOmf41251Ux

#------------------#
#- Backing Stores -#
#------------------#

NAME                           TYPE     TARGET-BUCKET                                                 PHASE   AGE
noobaa-default-backing-store   aws-s3   nb.1654144193284.cluster-d6qlm.d6qlm.sandbox458.opentlc.com   Ready   1d4h17m0s

#--------------------#
#- Namespace Stores -#
#--------------------#

No namespace stores found.

#------------------#
#- Bucket Classes -#
#------------------#

NAME                          PLACEMENT                                                        NAMESPACE-POLICY   PHASE   AGE
noobaa-default-bucket-class   {"tiers":[{"backingStores":["noobaa-default-backing-store"]}]}   null               Ready   1d4h17m0s

#-----------------#
#- Bucket Claims -#
#-----------------#

No OBCs found.</code></pre>
</div>
</div>
<div class="paragraph">
<p>CLIは最初に環境をチェックし、次に環境に関するすべての情報を出力します。MCGのステータスに加えて、MCGバケットへの接続に使用できる使用可能なS3エンドポイントアドレスとS3クレデンシャルが表示されます。<br>
S3アドレスはOpenShiftクラスタ内で内部的にルーティングするか、外部DNSを使用するかを選択できます。<br></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_object_bucket_claimの作成"><a class="anchor" href="#_object_bucket_claimの作成"></a>Object Bucket Claimの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>ObjectBucketClaim (OBC)</strong> は、OCPアプリケーションが使用できるS3互換のバケットを動的に作る場合に使われます。<strong>OBC</strong> を作成すると、実体である <strong>ObjectBucket (OB)</strong> と、アプリケーションがオブジェクトストレージサービスを使用するために必要なすべての情報を含む <strong>ConfigMap</strong> と <strong>Secret</strong> が作られます。</p>
</div>
<div class="paragraph">
<p>この機能のデモを行うために、Photo-Albumのデモアプリケーションを使用します。</p>
</div>
<div class="paragraph">
<p>アプリケーションをビルドしてクラスタにデプロイします。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f labitem/photo_album_app.yaml</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">buildconfig.build.openshift.io/python-s3-photo-album created
objectbucketclaim.objectbucket.io/photo-album created
imagestream.image.openshift.io/photo-album created
deploymentconfig.apps.openshift.io/photo-album created
service/photo-album created
route.route.openshift.io/photo-album created</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
デプロイには最大5分以上かかる場合があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>次のコマンドを実行してPhoto-Albumがデプロイが完了したことを確認します。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n demo get pods</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                   READY   STATUS      RESTARTS   AGE
photo-album-1-build    0/1     Completed   0          3m8s
photo-album-1-deploy   0/1     Completed   0          2m2s
photo-album-1-dsvkk    1/1     Running     0          119s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Photo-Albumアプリケーションのデプロイ中に作成した、<strong>OBC</strong> を見ることができます。以下を実行してください。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n demo get obc</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME          STORAGE-CLASS                 PHASE   AGE
photo-album   openshift-storage.noobaa.io   Bound   4m8s</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>OBC</strong> によって動的に作成された、<strong>OB</strong> も確認できます。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get ob</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                   STORAGE-CLASS                 CLAIM-NAMESPACE   CLAIM-NAME   RECLAIM-POLICY   PHASE   AGE
obc-demo-photo-album   openshift-storage.noobaa.io                                  Delete           Bound   6m8s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>OB</strong> は <strong>PV</strong> と同様に cluster-scoped なリソースなので、Namespaceを指定しなくても表示されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>また、以下のコマンドで新しいバケットの <strong>ConfigMap</strong> と <strong>Secret</strong> を表示することができます。<br>
<strong>ConfigMap</strong> には、バケット名、<strong>Service</strong>、ポートなどの重要な情報が含まれています。これらはすべて、S3エンドポイントへ接続するために使用されます。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n demo get cm photo-album -o yaml</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
data:
  BUCKET_HOST: s3.openshift-storage.svc
  BUCKET_NAME: photo-album-b1a7792d-dc51-498c-875a-42973290d09f
  BUCKET_PORT: "443"
  BUCKET_REGION: ""
  BUCKET_SUBREGION: ""
kind: ConfigMap
[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Secret</strong> には、アプリケーションが新しいバケットにアクセスするために必要なクレデンシャルが含まれます。クレデンシャルやキーは <code>base64</code> でエンコードされて <strong>Secret</strong> に保存されます。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n demo get secret photo-album -o yaml</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
data:
  AWS_ACCESS_KEY_ID: WUZSalBiMXRSMEM3aDdIeTRxcFk=
  AWS_SECRET_ACCESS_KEY: cnJselMyNUx3RldRM3BmOGVlYmdBRnhUWGoyYmh3UTNlcnNHYUpRUQ==
kind: Secret
[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>新しい <strong>OBC</strong> と <strong>OB</strong> が作成されると、MCG は関連する <strong>Secret</strong> と <strong>ConfigMap</strong> を作成し、photo-albumアプリケーションが新しいバケットを使用するために必要な全ての情報が含まれていることが分かるでしょう。</p>
</div>
<div class="paragraph">
<p>新しい <strong>Secret</strong> と <strong>ConfigMap</strong> の情報をアプリケーションがどのように使用するかを確認するには、アプリをデプロイした後に <strong>DeploymentConfig</strong> を参照してください。<strong>DeploymentConfig</strong> の指定セクションで <code>env:</code> を見つけ、<strong>ConfigMap</strong> と <strong>Secret</strong> の詳細が環境変数にどのようにマッピングされているかを確認することができます。<br></p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dc photo-album -o yaml -n demo</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps.openshift.io/v1
kind: DeploymentConfig
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
[...]
    spec:
      containers:
      - env:
        - name: BUCKET_HOST
          valueFrom:
            configMapKeyRef:
              key: BUCKET_HOST
              name: photo-album
        - name: BUCKET_NAME
          valueFrom:
            configMapKeyRef:
              key: BUCKET_NAME
              name: photo-album
        - name: AWS_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              key: AWS_ACCESS_KEY_ID
              name: photo-album
        - name: AWS_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              key: AWS_SECRET_ACCESS_KEY
              name: photo-album
[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>新しいバケットにオブジェクトを作成するには、まず <code>photo-album</code> アプリケーションの <strong>Route</strong> を見つける必要があります。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route photo-album -n demo -o jsonpath --template="http://{.spec.host}{'\n'}"</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">出力例:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><a href="http://photo-album.apps.cluster-d6qlm.d6qlm.sandbox458.opentlc.com" class="bare">http://photo-album.apps.cluster-d6qlm.d6qlm.sandbox458.opentlc.com</a></code></pre>
</div>
</div>
<div class="paragraph">
<p>このURLをコピーして、Webブラウザーのタブに貼り付けてください。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ocs/photo-album-select-upload.png" alt="Select Photo and Upload">
</div>
<div class="title">Figure 1. Select Photo and Upload</div>
</div>
<div class="paragraph">
<p>ローカルマシンにあるお好きな写真を1枚以上選択して、 <strong>Upload</strong> ボタンをクリックしてください。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ocs/photo-album-images.png" alt="View photos after uploading">
</div>
<div class="title">Figure 2. View photos after uploading</div>
</div>
<div class="paragraph">
<p>オブジェクトバケットにオブジェクトが正しく保存されているかを確認します。<br>
まず <strong>OpenShift Web Console</strong> でODFダッシュボードを開き、<strong>Storage Systems</strong> タブの下で <code>ocs-storagecluster-storagesystem</code> を選択します。次の画面で <strong>Object</strong> ダッシュボードを表示し、<code>System Name</code> の下にある <code>Mulitcloud Object Gateway</code> のリンクをクリックします。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ocs/System-Name-MCG-Console.png" alt="Launch MCG console from Object dashboard">
</div>
<div class="title">Figure 3. Launch MCG console from Object dashboard</div>
</div>
<div class="paragraph">
<p>別のタブで <code>MCG Console</code> が開かれるので、ログインします。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>"Access Denied" でログインできない場合は、<code>OK, Take Me To NooBaa Login</code> ボタンをクリックし、MCG Console の管理者アカウントでログインします。</p>
</div>
<div class="paragraph">
<p>Email Address には <code>admin@noobaa.io</code> を指定します。<br>
Password は、<code>noobaa status -n openshift-storage</code> の出力の中に表記されているので、探してみて下さい。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>画面左端にある <code>Buckets</code> を選択するとバケットの詳細に移動できます。ここで、<code>Object Buckets</code> タブを選択します。
.Login to MCG Console and select Buckets
image::ocs/MCG-Console-photo-album-buckets.png[Login to MCG Console and select Buckets]</p>
</div>
<div class="paragraph">
<p>あなたのバケット名を選択し、次に <code>Objects</code> タブを選択すると、写真をアップロードした際に作成された個々のオブジェクトを表示することができます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ocs/MCG-Console-photo-album-objects.png" alt="Validate uploaded photos are in your object bucket">
</div>
<div class="title">Figure 4. Validate uploaded photos are in your Object Bucket</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
