= Red Hat Advanced Cluster Security ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®è‡ªå‹•åŒ–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å®Ÿè£…ã¨DevSecOpsã®æ§‹ç¯‰

== ãƒ©ãƒœã®ç›®çš„

ã“ã®ãƒ©ãƒœã®ç›®æ¨™ã¯ã€ã•ã¾ã–ã¾ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã®çµ„ã¿åˆã‚ã›ã‚’ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã€å®‰å…¨ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ•ã‚¡ã‚¯ãƒˆãƒªã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ã“ã¨ã§ã™ã€‚ +
DevSecOps ã®å‡ºç¾ã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯å‰é¢ã¨ä¸­å¿ƒã«ç½®ã‹ã‚Œã€äººã€ãƒ—ãƒ­ã‚»ã‚¹ã€ãŠã‚ˆã³ã€æŠ€è¡“ã®é¢ã§å¯¾å‡¦ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ +
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã¯ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã«çµ±åˆã•ã‚Œã¦ãŠã‚Šã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ„ã¿è¾¼ã¾ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚²ãƒ¼ãƒˆã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ãŒæº€ãŸã•ã‚Œãªã„å ´åˆã€ç°¡å˜ã«ãƒ“ãƒ«ãƒ‰ã‚’ä¸­æ–­ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

== åºç« 

DevOpsã¨ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼ï¼ˆCI/CDï¼‰ã®åˆ©ç‚¹ã¯ã€é•·å¹´ã«ã‚ãŸã£ã¦å¤§ããªæˆæœã¨ã¨ã‚‚ã«å®Ÿè¨¼ã•ã‚Œã¦ãã¾ã—ãŸã€‚ +
çµ„ç¹”ã¯å¸¸ã«ã€ã‚ˆã‚Šå°‘ãªã„äººæ•°ã§ã‚ˆã‚Šå¤šãã®ã“ã¨ã‚’è¡Œã†ã“ã¨ã‚’æ±‚ã‚ã¦ãã¾ã—ãŸã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯å¤šãã®å ´åˆã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢æä¾›ãƒ—ãƒ­ã‚»ã‚¹ã®æœ«ç«¯ã®ã‚¢ãƒ‰ã‚ªãƒ³ã¨ã—ã¦æ‰±ã‚ã‚Œã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªã®é…å»¶ã«ã¤ãªãŒã‚‹ã“ã¨ã‚‚å°‘ãªãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ +
æ¥­ç•Œã¯ã€ã“ã‚Œã‚’å¤‰ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã‚’èªè­˜ã—ã¾ã—ãŸã€‚ +
çµ„ç¹”ã¯ã€å¥‘ç´„ä¸ŠãŠã‚ˆã³è¦åˆ¶ä¸Šã®ç¾©å‹™ã‚„ç¤¾å†…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¨™æº–ã‚’å¼•ãç¶šãæº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€æ©Ÿä¼šã‚’ç”Ÿã‹ã™ãŸã‚ã«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªã‚’åŠ é€Ÿã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚çµ„ç¹”ãŒã“ã‚Œã‚‰ã®æ¨™æº–ã‚’æº€ãŸã—ã€DevOpsã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã§ãƒ‡ãƒªãƒãƒªãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã€ç„¡é–¢ä¿‚ã«ãªã‚‹ã‹ã€æœ€æ–°ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«é©åˆã™ã‚‹ã‹ã®é¸æŠã«è¿«ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ +
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’è¿…é€Ÿã«æä¾›ã™ã‚‹ãŸã‚ã«ä¸å¯æ¬ ã§ã‚ã‚Šã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å“è³ªã®æŒ‡æ¨™ã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€"DevOps" ã« "Sec" ã‚’å«ã‚ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ +
DevSecOpsã®ç™»å ´ã«ã‚ˆã‚Šã€Shift Leftã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªãƒ—ãƒ­ã‚»ã‚¹ã®æ—©ã„æ®µéšã§ä¸å…·åˆã‚’ç™ºè¦‹ã—ã€é˜²æ­¢ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ãªã‚Šã¾ã—ãŸã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã«ç›´æ¥çµ±åˆã•ã‚Œã¾ã™ã€‚ãã®çµæœã€CI/CDãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚ˆã‚Šé€Ÿãé€²ã‚ã€ãƒ‡ãƒªãƒãƒªãƒ¼ã¾ã§ã®æœŸé–“ã‚’çŸ­ç¸®ã—ãªãŒã‚‰ã€å„ãƒªãƒªãƒ¼ã‚¹ã®å“è³ªã‚’ç¶™ç¶šçš„ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ã€‚ +
ã“ã®å®Ÿç¿’ã§ã¯ã€å…¸å‹çš„ãª CI/CD ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«è‡ªå‹•åŒ–ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹åˆ¶å¾¡ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹æŠ€è¡“ã®ã„ãã¤ã‹ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚ +
DevSecOps ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«ã€å¤šãã®ãƒ„ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€äº‹å‰ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã®ã»ã¨ã‚“ã©ã¯ã€Red Hat OpenShift ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã§ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚Œã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚ +
ä»¥ä¸‹ã¯ã€ç§ãŸã¡ã®ãƒ©ãƒœã§ã‚¹ãƒ†ãƒƒãƒ—ã‚¹ãƒ«ãƒ¼ã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã™:

image:cicd/lab4-devsecops01.png[800,800]

DevSecOpsã®CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€æ¬¡ã®ã‚ˆã†ãªæŠ€è¡“ã‚’ä½¿ç”¨ã—ã¾ã™:

- https://tekton.dev[Tekton] ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ https://www.openshift.com/learn/topics/ci-cd[OpenShift Pipelines] 
- https://argoproj.github.io/[ArgoCD] ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ https://www.openshift.com/blog/announcing-openshift-gitops[OpenShift GitOps]
- https://www.redhat.com/en/resources/advanced-cluster-security-for-kubernetes-datasheet[Red Hat Advanced Cluster Security for Kubernetes]
- https://docs.openshift.com/container-platform/latest/registry/architecture-component-imageregistry.html[OpenShift Container Registry]
- https://www.sonarqube.org/[SonarQube]
- https://www.sonatype.com/products/repository-oss?topnav=true[Nexus]
- https://junit.org/junit5/[JUnit]
- https://gogs.io/[Gogs]
- https://tekton.dev/docs/triggers/[Git Webhook]
- https://gatling.io/[Gatling]
- https://www.zaproxy.org/[Zap Proxy]

[#ci]
== ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã“ã®æœ€åˆã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯ã€ã‚µãƒ³ãƒ—ãƒ«ã§ç”¨æ„ã—ã¦ã„ã‚‹ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ OpenShift Pipeline ã§å®Ÿè¡Œã—ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚ +
ã“ã®ãƒ©ãƒœã§ã¯ã€Tekton ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®é–‹å§‹æ–¹æ³•ã¨ã€é–‹ç™ºãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å†…ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ gitops ãƒ„ãƒ¼ãƒ«ã‚’çµ±åˆã™ã‚‹ãŸã‚ã®ã‚¿ã‚¹ã‚¯ã®ä½¿ç”¨æ–¹æ³•ã‚’å­¦ç¿’ã—ã¾ã™ã€‚

. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€3ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®3ã¤ã®Optionã„ãšã‚Œã‹ã§ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„:
** Option 1: Developer UIã‚’ä½¿ç”¨ã—ã¦é–‹å§‹ã™ã‚‹å ´åˆ
.. ãƒ–ãƒ©ã‚¦ã‚¶ã§ OpenShift Console ã® URL ã‚’å‚ç…§ã—ã¾ã™ã€‚
.. æä¾›ã•ã‚ŒãŸadminãƒ¦ãƒ¼ã‚¶ã®èªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
.. ã¾ã é–‹ç™ºè€…ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–ã«ã„ãªã„å ´åˆã¯ã€å·¦ä¸Šã®é–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã«Developerã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops04.png[200,200]
+
.. ocp-workshop ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops05.png[200,200]
+
.. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® ``Pipelines`` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops06.png[400,700]
+
.. " petclinic-build-dev "ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops07.png[600,800]
+
.. å³ä¸Šã® â€œActionsâ€ ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ â€œstartâ€ ã‚’é¸æŠã—ã¾ã™ã€‚
.. "Workspaces"ã§PVCã‚’é¸æŠã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè¡Œæ™‚ã«ä½¿ç”¨ã™ã‚‹å…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‘ã‚¹ã¨ã—ã¦PVC petclinic-build-workspaceã‚’é¸æŠã—ã¾ã™ã€‚
.. "maven-settings" ã§ã€ŒConfig Mapã€ã‚’é¸æŠã—ã€"maven-settings" ã‚’Config Mapã¨ã—ã¦é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops08.png[200,700]
+
.. start ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
** Option 2: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’èµ·å‹•ã™ã‚‹å ´åˆã€‚
ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ãƒ†ã‚¹ãƒˆä¸­ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã®ã«ä¾¿åˆ©ãªæ–¹æ³•ã§ã€PRã‚„gitã¸ã®pushã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’èµ·å‹•ã•ã›ã‚‹æ–¹æ³•ã§ã™ã€‚CLIã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã®ãŒå¥½ããªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã§ã™ã€‚
+
.. å®Ÿè¡Œ:
+
[source]

|===
|oc create -f https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/pipeline-build-dev-run.yaml -n ocp-workshop

|===
+
** Option 3: æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒgit repoã«pushã•ã‚Œã‚‹ã¨ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã«ã‚‚ãªã‚Šã¾ã™ã€‚ã“ã®ãƒ©ãƒœã§ã¯ã€git repo ã¯ Gogs ã§ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã¯ã€ã€ŒGogsã€git repoçµŒç”±ã§ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚
ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€é–‹ç™ºè€…ã®è¦³ç‚¹ã‹ã‚‰ã™ã‚‹ã¨æœ€ã‚‚ãƒãƒ”ãƒ¥ãƒ©ãƒ¼ãªã‚‚ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚PR ã‚„ git ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå§‹ã¾ã‚Šã€webhook ãŒè‡ªå‹•çš„ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚
+
.. é–‹ç™ºã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã€å·¦ã®ãƒŠãƒ“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹ `Search` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. 'route'ã¨å…¥åŠ›ã—ã€ãƒªã‚¹ãƒˆã®ä¸­ã‹ã‚‰``Route``ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops09.png[400,400]
+
.. `Gogs` ãƒ«ãƒ¼ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€gogs ã® URL ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:
+
image:cicd/lab4-devsecops10.png[400,600]
+
.. ``ã‚µã‚¤ãƒ³ã‚¤ãƒ³``ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€__gogsadmin__ã®èªè¨¼æƒ…å ±ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops11.png[500,400]
+
|===
|User: gogsadmin
|Password: openshift
|===
+
.. gogsadminã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®spring-petclinicãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠã—ã¾ã™:
+
image:cicd/lab4-devsecops12.png[400,700]
+
.. README.mdã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€``Edit this file``ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€å¤‰æ›´ã‚’åŠ ãˆã¦ãã ã•ã„:
+
image:cicd/lab4-devsecops13.png[400,700]
+
.. å°å…¥ã—ãŸå¤‰æ›´ã‚’README.mdã«ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™:
+
image:cicd/lab4-devsecops14.png[400,700]
+
[æ³¨æ„] ã“ã‚Œã¯ã‚ãã¾ã§ãƒ‡ãƒ¢ã®ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚é€šå¸¸ã€master ã¸ã® push ã¯æ¨å¥¨ã•ã‚Œãšã€ä»£ã‚ã‚Šã«ä»–ã®ãƒ–ãƒ©ãƒ³ãƒ (ä¾‹ãˆã° develop) ã‹ã‚‰ã® Pull Request / Merge Request ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
+
.. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ©ãƒœã®ã‚¹ãƒ†ãƒƒãƒ— 6 ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã€Pipeline Runs ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
+
. æä¾›ã•ã‚ŒãŸOpenShiftã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®URLã‚’ä½¿ã£ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ãã¾ã™ã€‚
. æä¾›ã•ã‚ŒãŸã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
. ``Developer``ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€é–‹ç™ºè€…ç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚
+
image:cicd/lab4-devsecops04.png[200,200]
+
. ``ocp-workshop``ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
+
image:cicd/lab4-devsecops15.png[300,300]
+
. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® `Pipelines` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops16.png[400,700]
+
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã® `petclinic-build-dev` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`Pipeline Runs` ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops17.png[400,700]
+
. `Pipeline Runs` ã‚¿ãƒ–ã§å®Ÿè¡Œä¸­ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã¨ä¸‹å›³ã®ã‚ˆã†ãªPipeline Run detailsãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€çŠ¶æ³ã‚’ã”è¦§ãã ã•ã„ã€‚
+
image:cicd/lab4-devsecops18.png[500,700]
+
ã—ã°ã‚‰ãã™ã‚‹ã¨ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œã®ã‚¹ãƒ†ãƒƒãƒ—ã€Œimage-checkã€ã§å¤±æ•—ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹é‡è¦ãªæ·±åˆ»åº¦ã®è„†å¼±æ€§ãŒãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒˆãƒãƒªã‚·ãƒ¼ã«å¼•ã£ã‹ã‹ã‚Šã€ãƒ‡ãƒ—ãƒ­ã‚¤ãŒåœæ­¢ã™ã‚‹ãŸã‚ã§ã™ã€‚
+
image:cicd/lab4-devsecops20.png[500,700]
+
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ­£å¸¸ã«å®Œäº†ã•ã›ã‚‹ãŸã‚ã«ã¯ã€ã“ã®è„†å¼±æ€§ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãã‚Œã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€æ­£å¸¸ã«å®Ÿè¡Œã•ã‚ŒãŸå ´åˆã®çŠ¶æ…‹ã§ã™ã€‚
+
image:cicd/lab4-devsecops19.png[500,700]
+
æ¬¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€Lab 4.2ã§ã¯ã€ä½•ãŒèµ·ã“ã£ãŸã®ã‹ç¢ºèªã—ã€ãã‚Œã‚’å®‰å…¨ã«è§£æ±ºã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
+
[æ³¨æ„] æ‰‹å‹•ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã«åŠ ãˆã€Gogs gitã‚µãƒ¼ãƒãƒ¼ä¸Šã®spring-petclinic gitãƒªãƒã‚¸ãƒˆãƒªã«pushã™ã‚‹ãŸã³ã«ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒé–‹å§‹ã•ã‚Œã‚‹ã¨ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°ãªãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ¬¡ã®æ•°ã‚¹ãƒ†ãƒƒãƒ—ã§å¹¾ã¤ã‹ã®ç¢ºèªæ–¹æ³•ã‚’æŒ‡ç¤ºã—ã¾ã™ã€‚
.. *Source Clone* - ã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã“ã®ãƒ©ãƒœã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹Gitï¼ˆGogsï¼‰ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰pullã•ã‚Œã¦ã„ã¾ã™ã€‚
+
[æ³¨æ„] ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã‚ã‚‰ã‹ã˜ã‚è¨­å®šã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä»‹ã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¹ãƒ†ãƒƒãƒ—é–“ã§æŒç¶šã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops24.png[400,700]
+
... git repo ã® URL ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã‚’é–‹ã„ã¦URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¾ã™
... URLã¯ä»¥ä¸‹ã®ã‚ˆã†ã«Gogsã®git repoã«ç§»å‹•ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops25.png[600,700]
+
... ``gogsadmin``ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã®ãƒ©ãƒœã®ãŸã‚ã«2ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
+
gogsadminãƒ¦ãƒ¼ã‚¶ã®èªè¨¼æƒ…å ±ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:
+
|===
|User: gogsadmin
|Pass: openshift
|===
+
.. *Dependency Report* ã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ãƒ—ãƒªã®ä¾å­˜é–¢ä¿‚ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã€ãƒ¬ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚
+
image:cicd/lab4-devsecops26.png[300,700]
+
reportã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†!
+
... é–‹ç™ºã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã€å·¦ã®ãƒŠãƒ“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹ `Search` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
... Resourcesã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€``route``ã¨å…¥åŠ›ã€ãƒªã‚¹ãƒˆã‹ã‚‰``Route``ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops09.png[400,400]
+
... reports-repo ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚
+
image:cicd/lab4-devsecops27.png[300,700]
+
... ã“ã®ãƒšãƒ¼ã‚¸ã® `petclinic-build` ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops28.png[300,500]
+
... å¼•ãç¶šãã€spring-petclinic â†’ target â†’ site ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
... ãã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ `Dependencies` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ãã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§è©³ç´°ã‚’èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
+
image:cicd/lab4-devsecops29.png[300,700]
+
.. *Unit tests* ã‚¿ã‚¹ã‚¯ã¯ã€ä¾å­˜æ€§ãƒ¬ãƒãƒ¼ãƒˆã¨ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops30.png[300,700]
+
. *Release-app* ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’JARã¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã€Sonatype Nexusã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops31.png[300,700]
+
. *Build-image* ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€DEVç’°å¢ƒã§S2Iã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã€OpenShiftã®å†…éƒ¨ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã€spring-petclinic:[branch]-[commit-sha] ãŠã‚ˆã³ spring-petclinic:latest ã§ã‚¿ã‚°ä»˜ã‘ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops32.png[300,700]

[#devsecops]
== Advanced Cluster Securityã‚’åˆ©ç”¨ã—ãŸDevSecOpsã®ã‚¹ãƒ†ãƒƒãƒ—

Red Hat Advanced Cluster Security (ACS) for Kubernetes ã¯ã€ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€å˜ä¸€ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚ +
ç¬¬ä¸€ä¸–ä»£ã®ã‚³ãƒ³ãƒ†ãƒŠã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦ã„ã¾ã™ãŒã€ACSã¯Kubernetesã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦ãŠã‚Šã€Kubernetesã®å®£è¨€å‹ãƒ‡ãƒ¼ã‚¿ã¨ãƒ“ãƒ«ãƒˆã‚¤ãƒ³åˆ¶å¾¡ã‚’æ´»ç”¨ã—ãŸKubernetesãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€ãƒªãƒƒãƒãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€ãƒã‚¤ãƒ†ã‚£ãƒ–ãªå®Ÿæ–½ã€ç¶™ç¶šçš„ãªãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã€DevOpsãƒãƒ¼ãƒ ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‹ç”¨ã‚’æ”¯æ´ã—ã¾ã™ã€‚ã•ã‚‰ã«ã€Kubernetes ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ãŸ ACS ã¯ã€DevOpsãƒãƒ¼ãƒ ãŠã‚ˆã³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¶­æŒã‚’é‹ç”¨ã§ãã‚‹ã‚ˆã†æ”¯æ´ã—ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ†ã‚£ãƒ–ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä¿è­·ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç°¡ç´ åŒ–ã—ã¾ã™ã€‚

ã“ã®ãƒ©ãƒœã§ã¯ã€ACS ãŒ CI/CD ãƒ—ãƒ­ã‚»ã‚¹ã«ã©ã®ã‚ˆã†ã«çµ±åˆã•ã‚Œã‚‹ã‹ã‚’å­¦ã³ã¾ã™ã€‚ACSã¯ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç°¡ç´ åŒ–ã™ã‚‹ã ã‘ã§ãªãã€çµ„ç¹”å†…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ã«å¯è¦–æ€§ã‚’æä¾›ã—ã¾ã™ã€‚
 https://docs.openshift.com/acs/cli/getting-started-cli.html[roxctl] ã¨ ACS API ã‚’ä½¿ã£ã¦ã€ã„ãã¤ã‹ã®è¿½åŠ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ãƒ†ãƒƒãƒ—ã‚’ DevSecOps ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ±åˆã—ã¾ã—ãŸ:

. *image scan* ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ACSã‚¹ã‚­ãƒ£ãƒŠã‚’ä½¿ç”¨ã—ã¦ã€æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§ç”Ÿæˆã•ã‚Œã€ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops33.png[300,700]
+
ãƒ­ã‚°ã«ã‚ã‚‹ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã¯ã€`pretty` ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒéæ¨å¥¨ã§ã‚ã‚‹ã“ã¨ãŒåŸå› ã§ã™ã€‚
+
|===
|ERROR:	invalid output format "pretty" used. You can only specify json or csv
|===
+
ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§è¡Œã„ã¾ã™ã€‚

.. å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ `Pipelines` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `petclinic-build-dev` ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `Actions` -> ``Edit Pipeline``ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `image-scan` ã‚¿ã‚¹ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`pretty` ã®ä»£ã‚ã‚Šã« `csv` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
+
image:cicd/lab4.2-image-scan.png[500,700]
+
.. ``Save``ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ `Actions` -> rerun ã‚’é¸æŠã™ã‚‹ã¨ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã®å®Ÿéš›ã®å‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4.2-image-scan-withlogs.png[500,700]
+
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ­ã‚°ã«ã¯ã€ACSã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã¸ã®ç›´æ¥ã®ãƒªãƒ³ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
+
[æ³¨æ„] ã‚‚ã—ã€ãã®ãƒªãƒ³ã‚¯å…ˆã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨¼æ˜æ›¸ã®è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‚ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚ +
ã‚³ãƒ”ãƒ¼ã—ã¦åˆ¥ã®ã‚¿ãƒ–ã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨ã€ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã®è©³ç´°ãªæƒ…å ±ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:
+
|===
|User: admin
|Pass: stackrox
|===
+
URLã¯ã€Vulnerability Managementã«ç§»å‹•ã—ã¾ã™ã€‚ã“ã®Imageã«å«ã¾ã‚Œã‚‹è„†å¼±æ€§(CVE)ã®æ¦‚è¦ã‚’èª¬æ˜ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops35.png[500,700]
+
.. Deployment ã‚¿ãƒ–ã§ã€
ACSãƒ„ãƒ¼ãƒ«ã¯ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’èªè­˜ã—ã¾ã™ã€‚æœ€åˆã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã™ã¹ã¦ã®ã‚²ãƒ¼ãƒˆã‚’é€šéã—ãªã‹ã£ãŸã®ã§ã€æœ€åˆã¯ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„ã§ã—ã‚‡ã†ã€‚

.. Component ã‚¿ãƒ–ã¯ã€
ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã®ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ“ãƒ¥ãƒ¼ã§ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ä¿®æ­£å¯èƒ½ãª CVE ã®æ•°ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® CVE ã«é–¢é€£ã™ã‚‹ CVSS ã‚¹ã‚³ã‚¢ã®ãƒˆãƒƒãƒ—ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å«ã‚€ä»–ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãªã©ã®é–¢é€£æƒ…å ±ãŒä¸€è¦§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops34.png[500,700]
+
ä¾‹ãˆã°ã€tomcat 9.0.31 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä¸‹å›³ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¸ã«ã¯ã€ãƒªã‚¹ã‚¯ã®å„ªå…ˆé †ä½ã€CVE ã®æƒ…å ±ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å ´æ‰€ã€CVE ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4.2-tomcat-cve.png[500,700]
+
.. å³ä¸Šã® â€œXâ€ ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æˆ»ã‚‹ã“ã¨ãŒã§ãã¾ã™
.. CVEsã‚¿ãƒ–ã¯ã€Imageã®ã™ã¹ã¦ã®è„†å¼±æ€§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops36.png[500,700]
+
.. `Overview` ã‚¿ãƒ–ã«æˆ»ã‚Šã€`Image findings` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã™ã‚‹ã¨ã€ä¿®æ­£å¯èƒ½ãª CVE ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€ACS ãŒä¿®æ­£å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’èªè­˜ã—ã¦ã„ã‚‹ CVE ã§ã™ã€‚
+
image:cicd/lab4-devsecops37.png[300,700]
+
.. ``Image Findings``ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸Šã«ã‚ã‚‹ ``Dockerfile`` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ '>' ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹ã™ã‚‹ã¨ã€ACS CVEãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ˆã‚Šã€å„ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«è©³ç´°ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨é–¢é€£ã™ã‚‹CVEãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops38.png[400,700]
+
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å¾©ç¿’ã‚’ç¶šã‘ã‚‹å‰ã«ã€ACSã§ã®ç¢ºèªã‚’è‡ªç”±ã«è¡Œã£ã¦ãã ã•ã„ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã¨ãƒ„ãƒ¼ãƒ«ã®æ©Ÿèƒ½ã‚’ç†è§£ã™ã‚‹ã“ã¨ã¯ã€ã“ã®ãƒ©ãƒœã®é‡è¦ãªéƒ¨åˆ†ã§ã‚ã‚Šã€å®‰å…¨ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é…ä¿¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®çŸ¥è­˜ã‚’é«˜ã‚ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚
+
ã“ã“ã§ã€OpenShift Developerã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã¾ã™ã€‚
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã® *Image Check* ã‚¹ãƒ†ãƒƒãƒ—
+
[æ³¨æ„] ACSã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹æ§˜ã€…ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®ãƒ“ãƒ«ãƒ‰æ™‚ã®é•å
+
image:cicd/lab4-devsecops39.png[400,700]
+
image:cicd/lab4-devsecops40.png[400,700]
+
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦ã€ACS ã§å®šç¾©ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒãƒªã‚·ãƒ¼ã®ãƒ“ãƒ«ãƒ‰æ™‚ãŠã‚ˆã³ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®é•åã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ACSã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®å®Ÿæ–½ã‚’è¨­å®šã—ãŸãŸã‚ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼é•åã§ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã“ã®ã‚¿ã‚¹ã‚¯ã§å¤±æ•—ã—ã¾ã™ã€‚
è„†å¼±æ€§ã®é«˜ã„ã‚³ãƒ³ãƒ†ãƒŠå‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å±•é–‹ã—ãªã„ãŸã‚ã«ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¹ã‚­ãƒ£ãƒ³ãŒé‡è¦ã§ã™ã€‚

. *Deploy-check* ã¯ã€ãƒ­ã‚°ã«ãƒãƒªã‚·ãƒ¼ã®é•åãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ­ã‚°ã«ã¯é•åãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã®ä¾‹ã§ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã®å¼·åˆ¶ãŒã‚ªãƒ³ã«ãªã£ã¦ã„ãªã„ãŸã‚ã€ã“ã®ã‚¿ã‚¹ã‚¯ã§å¤±æ•—ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã®å¾Œã®ãƒ©ãƒœã§ã€ãƒãƒªã‚·ãƒ¼ã®è©³ç´°ã‚’ç¢ºèªã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops41.png[400,700]
+
[æ³¨æ„] ã“ã®3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ*deploy-check, image-check, image-scan*ï¼‰ã¯ã€DevSecOpsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ™‚é–“çŸ­ç¸®ã®ãŸã‚ã«ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
+
. ã‚‚ã— *image-check* ãŒå¤±æ•—ã—ãŸã‚‰ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œã«ç§»å‹•ã—ã¦ `image-check` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ãƒ­ã‚°ã®ä¸€ç•ªä¸‹ã« `Error: failed policies found: 1 policy violated that are failing the check.` ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¯ã€é•åãŒç™ºç”Ÿã—ãŸå ´åˆã« ACS ãŒãƒ“ãƒ«ãƒ‰ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ã‹ã‚‰ãƒãƒªã‚·ãƒ¼ã‚’å¼·åˆ¶ã™ã‚‹ãŸã‚ã§ã™ã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€Tektonã‚¿ã‚¹ã‚¯ã®roxctlã‚’ä»‹ã—ã¦ACSã‚’çµ±åˆã—ã¦ã„ã¾ã™ã€‚
+
ImageãŒãƒãƒªã‚·ãƒ¼ã«é•åã—ãŸå ´åˆã€ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã€ãƒã‚§ãƒƒã‚¯ã«åˆæ ¼ã™ã‚‹ã¾ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚ãƒ­ã‚°ã«ã¯é•åã®ä¸€è¦§ã¨å¯¾å‡¦æ³•ãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚é–‹ç™ºè€…ã¯ `image-check` ã‚¿ã‚¹ã‚¯ã®ãƒ­ã‚°ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã€ãã‚Œã«å¿œã˜ã¦å¤‰æ›´ã‚’åŠ ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¿®æ­£ãŒGitã«ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã•ã‚Œã‚‹ã¨ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒèµ·å‹•ã•ã‚Œã¾ã™ã€‚ä»Šå›ã€xref:fiximage[Imageã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã®ãƒœãƒ¼ãƒŠã‚¹ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º]ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚ã‚‚ã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä¸Šã§ä»–ã®ã‚¿ã‚¹ã‚¯ã®ãƒ†ã‚¹ãƒˆã‚’ç¶šã‘ãŸã„å ´åˆã¯ã€ãƒãƒªã‚·ãƒ¼ã«ä¾‹å¤–ã‚’è¿½åŠ ã—ã¦ã€spring-petclinicã‚’é™¤å¤–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãƒãƒªã‚·ãƒ¼ã«ä¾‹å¤–ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯ã€é–‹ç™ºè€…ãŒã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã‹ã¤ã€CIãƒ—ãƒ­ã‚»ã‚¹ãŒãƒ†ã‚¹ãƒˆã‚’ç¶™ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«æœ‰åŠ¹ã§ã‚ã‚‹ã€‚
+
[æ³¨æ„] é•åã‚’ç„¡ãã—ã¦ã€ãƒã‚§ãƒƒã‚¯ã«åˆæ ¼ã™ã‚‹ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
+
spring-petclinicãƒ“ãƒ«ãƒ‰ã®ãƒãƒªã‚·ãƒ¼ã‚’è¿‚å›ã™ã‚‹ä¾‹å¤–ã‚’è¿½åŠ ã—ãŸã„å ´åˆã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
+
.. *image-check* ã‚¿ã‚¹ã‚¯ã®ãƒ­ã‚°ã‚’èª¿ã¹ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå¤±æ•—ã®åŸå› ã¨ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã™:
+
|===
|âœ— Image image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic@sha256:ece54d2923654c36f4e97bc0410f5c027871c5b7483e977cfc6c2bd56fef625d and '*ERROR: Policy "Fixable Severity at least Important"*'
|===
+
.. `ãƒ¯ãƒƒãƒ•ãƒ«ã‚¢ã‚¤ã‚³ãƒ³` image:cicd/lab4-devsecops42.png[20,20] ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º â†’ ä»¥ä¸‹ã®ã‚ˆã†ã« `Red Hat Advanced Cluster Security For Kubernetes` ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops43.png[700,300]
+
.. ACSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã‚ˆã†ä¿ƒã•ã‚Œã¾ã™ â†’ `Advanced` ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ `Proceed to central-stackrox.apps.cluster...` ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€²ã¿ã¾ã™ã€‚
.. ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:
+
|===
|User: admin
|Pass: stackrox
|===
+
.. ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops44.png[300,700]
+
.. å·¦ä¸Šã® image:cicd/lab4-devsecops45.png[20,20] ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ Platform Configuration ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ Policies ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops46.png[100,200]
+
.. Policies ã®ä¸‹ã«ã‚ã‚‹æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã€ãƒãƒªã‚·ãƒ¼å *Fixable Severity at least Important* ã‚’å…¥åŠ›ã—ã€Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚çµæœã€ãƒãƒªã‚·ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops47.png[300,700]
+
* `Fixable Severity at least Important` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒãƒªã‚·ãƒ¼ã®è©³ç´°ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒãƒªã‚·ãƒ¼ãƒšãƒ¼ã‚¸ã§ã¯ã€`Actions` ã§ãƒãƒªã‚·ãƒ¼ã®ç·¨é›†ã€ã‚¯ãƒ­ãƒ¼ãƒ³ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ç„¡åŠ¹åŒ–ãŒã§ãã¾ã™ã€‚`Actions` ã®ä¸­ã«ã‚ã‚‹ ``Edit policy`` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚é–‹ç™ºè€…ã¯ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®æƒ…å ±ã‚’ä½¿ã£ã¦ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã®æƒ…å ±ã¯ã€ãƒãƒªã‚·ãƒ¼ã®å¼·åˆ¶ãŒè¡Œã‚ã‚Œã‚‹å ´æ‰€ã§ã™ã€‚æœ‰åŠ¹ãªãƒãƒªã‚·ãƒ¼ã«é•åã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é€šéã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
+
image:cicd/lab4-devsecops48_new.png[300,700]
+
* ``Policy details``ã§ `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* ``Policy behavior``ã§ `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* ``Policy criteria`` ã® `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚Imageã‚’é™¤å¤–ã™ã‚‹ãŸã‚ã«ã€``Policy scope`` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã® UI ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
* Exclude imagesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€`Excluded Images (Build Lifecycle only)` ãƒªã‚¹ãƒˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã‚’ã‚¿ã‚¤ãƒ—ã—ã¾ã™:
+
|===
|image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic
|===
+
* ``Create "image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic"``Imageã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
+
image:cicd/lab4.2-5-exclude-image_new.png[300,700]
+
* `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* ãƒãƒªã‚·ãƒ¼ã®å¤‰æ›´å†…å®¹ã‚’ç¢ºèªã—ã¦ã€`Save` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
.. ã“ã‚Œã§ã€``Fixable Severity``ã®ãƒãƒªã‚·ãƒ¼ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
+
image:cicd/lab4.2-5-2Policy_new.png[300,700]
+
.. OpenShift developer console ã«æˆ»ã‚Šã€ãƒŠãƒ“ã® â€œocp-workshopâ€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸‹ã«ã‚ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops52.png[300,700]
+
.. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops53.png[300,700]
+
.. Pipeline Runsã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€é–‹å§‹ã—ãŸPipeline Runã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops54.png[300,700]
+
image:cicd/lab4-devsecops55.png[300,700]
+
.. [æ³¨æ„]``image-check`` ã‚¹ãƒ†ãƒƒãƒ—ã§ã€é‡å¤§ã§ã¯ãªã„ãã®ä»–ã® ACS ãƒãƒªã‚·ãƒ¼é•åã«å¯¾ã™ã‚‹è­¦å‘ŠãŒå¼•ãç¶šãè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œãšã€æ­£å¸¸ã«å®Œäº†ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops55a.png[300,700]
+
.. ãƒœãƒ¼ãƒŠã‚¹ãƒ©ãƒœï¼š ä½™è£•ã®ã‚ã‚‹æ–¹ã¯ã€ xref:fiximage[bonus lab] ã§Imageã‚’ä¿®æ­£ã—ã€é•åã®ãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¦ãã ã•ã„ã€‚  +
å¯¾å¿œãŒçµ‚ã‚ã£ãŸã‚‰ã€ä¸Šã§ä»˜ä¸ã—ãŸãƒãƒªã‚·ãƒ¼ã®ä¾‹å¤–ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
.. *update deployment step* ã‚¿ã‚¹ã‚¯ã§ã€Kubernetes kustomization ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€devç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã«ã‚ã‚‹æœ€æ–°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ [commit-sha] ã§æ›´æ–°ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç§ãŸã¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸç‰¹å®šã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops56.png[300,700]

[#cd]
== GitOpsã‚’ä½¿ã£ãŸç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼

GitOpsã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ†ã‚£ãƒ–ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¶™ç¶šçš„ãªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®å®£è¨€çš„ãªæ–¹æ³•ã§ã™ã€‚GitOpsã‚’ä½¿ç”¨ã—ã¦ã€ãƒãƒ«ãƒã‚¯ãƒ©ã‚¹ã‚¿Kubernetesç’°å¢ƒã«ã‚ãŸã‚‹OpenShift Container Platformã‚¯ãƒ©ã‚¹ã‚¿ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®åå¾©å¯èƒ½ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚GitOpsã¯ã€è¤‡é›‘ãªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’é«˜é€Ÿã«å‡¦ç†ã—è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒªãƒªãƒ¼ã‚¹ã‚µã‚¤ã‚¯ãƒ«ã®æ™‚é–“ã‚’çŸ­ç¸®ã—ã¾ã™ã€‚ +
GitOps ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã€ãƒ†ã‚¹ãƒˆã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã€ãã—ã¦æœ¬ç•ªã¸ã¨ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚GitOps ã¯æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‹æ—¢å­˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹ã®ã§ã€ç§ãŸã¡ã¯ãƒªãƒã‚¸ãƒˆãƒªã‚’æ›´æ–°ã™ã‚‹ã ã‘ã§ã‚ˆãã€ä»–ã®ã™ã¹ã¦ã¯ GitOps ãŒè‡ªå‹•åŒ–ã—ã¾ã™ã€‚

Argo CD ã¯ Git ãƒªãƒã‚¸ãƒˆãƒªã«ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’ç¶™ç¶šçš„ã«ç›£è¦–ã—ã€DEV ãŠã‚ˆã³ STAGE ç’°å¢ƒã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã«ã€Kustomize ã‚’ä½¿ç”¨ã—ã¦ç’°å¢ƒå›ºæœ‰ã®è¨­å®šã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã—ã¾ã™ã€‚

image:cicd/lab4-devsecops57.png[300,700]

. ArgoCD ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Gogs ã® git ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’åŒæœŸã—ã€å®šç¾©ã•ã‚ŒãŸãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«è‡ªå‹•çš„ã«å¤‰æ›´ã‚’é©ç”¨ã—ã¾ã™:
.. ä¸Šéƒ¨ã®ãƒ¯ãƒƒãƒ•ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã«ç§»å‹•ã—ã€"Cluster Argo CD "ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops43.png[300,300]
+
.. ãƒªãƒ³ã‚¯ã¯ Argo CD ã®ãƒ­ã‚°ã‚¤ãƒ³ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚åˆã‚ã¦Argo CDã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å ´åˆã¯ã€``Advanced`` â†’ ``Proceed to openshift-gitops-server-openshift-gitops.apps...`` ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
.. "admin" ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã‚ã«ã¯ã€ã¾ãšã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ãã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚
+
[source]
----
oc get secret/openshift-gitops-cluster -n openshift-gitops -o jsonpath='{.data.admin\.password}' | base64 -d ; echo
----
+
.. ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« Argo CD ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops58.png[500,600]
+
.. ``dev-spring-petclinic`` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
. ArgoCD ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® branch/repo ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ "Synced" ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚
+
image:cicd/lab4-devsecops59.png[300,700]
+
.. image:cicd/lab4-devsecops101.png[100,90] ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ 'dev-spring-petclinic' ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops102.png[900,700]
+
.. ä¸Šè¨˜ã®è©³ç´°ã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚OpenShift Dev ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã€å·¦å´ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ devsecops-dev project ã®ä¸‹ã«ã‚ã‚‹ ``Topology`` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚çŸ¢å°ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
+
image:cicd/lab4-devsecops60.png[300,500]
+
* ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops61.png[500,500]
+
.. Argo CD ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã¾ã™ã€‚å·¦ä¸Šã® ``Applications`` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
[æ³¨æ„]  `stage-spring-petclinic` ã® namespace ã¯ devsecops-qa ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
+
image:cicd/lab4-devsecops62.png[300,300]
+
.. `stage-spring-petclinic` ã‚’ã‚¯ãƒªãƒƒã‚¯
+
image:cicd/lab4-devsecops63.png[300,700]
+
.. ãƒˆãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® image:cicd/lab4-devsecops64.png[40,50] ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ devsecops-qa ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã« â€œSyncedâ€ ã•ã‚Œã‚‹ã¾ã§å¾…ã¡ã¾ã™ã€‚
+
image:cicd/lab4-devsecops65.png[300,700]
+
.. OpenShift Dev ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã€å·¦ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ devsecops-qa project ã®ä¸‹ã«ã‚ã‚‹ ``Topology`` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops66.png[300,300]
+
.. ä»¥ä¸‹ã®ã‚ˆã†ã«ã€devsecops-qa ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã—ãŸã€‚
+
image:cicd/lab4-devsecops67.png[300,500]

[#dast]
== PostCI - ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ†ã‚¹ãƒˆ (DAST)

*å‹•çš„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ (DAST)* ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡ŒçŠ¶æ…‹ã«ãŠã„ã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è„†å¼±æ€§ã‚’ç¤ºå”†ã™ã‚‹çŠ¶æ…‹ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚DASTã¯ã€é‹ç”¨ä¸­ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’ç‰¹å®šã™ã‚‹ä¸Šã§é‡è¦ãªå½¹å‰²ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚DASTã®ä¾µå…¥ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã‚ˆã‚Šã‚‚å…ˆã«ãã‚Œã‚‰ã®è„†å¼±æ€§ã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã®ãƒ©ãƒœã§ã¯ã€ä¾‹ã¨ã—ã¦ZAPã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒDevã‹ã‚‰QAã«æ˜‡æ ¼ã—ãŸå¾Œã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¨ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãŒä¸¦è¡Œã—ã¦é–‹å§‹ã•ã‚Œã¾ã™ã€‚

. Openshift Pipelines ã® CI ã¯ã€ArgoCD ã‚¢ãƒ—ãƒªãŒå®Œå…¨ã«åŒæœŸã•ã‚Œ (*Wait Application step*) ã€ç§ãŸã¡ã®ã‚¢ãƒ—ãƒªã¨ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã¾ã§å¾…ã¡ã¾ã™ã€‚
.. æˆåŠŸã—ãŸå®Ÿè¡Œæ¸ˆã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ç§»å‹•ã—ã€ã‚¹ãƒ†ãƒƒãƒ— *wait-application* ã«ç§»å‹•ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops68.png[300,700]
+
.. ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ArgoCD ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®èªè¨¼ã‚’è¡Œã„ã€Git ãƒªãƒã‚¸ãƒˆãƒªï¼ˆgogsï¼‰ã‹ã‚‰ OCP ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« 'dev-spring-petclinic' ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŒæœŸå‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops69.png[300,700]
+
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€*perf-test-clone* ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
+
ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆ*Performance Tests Clone*ï¼‰ã•ã‚Œã¾ã™ã€‚
+
image:cicd/lab4-devsecops70.png[300,700]
+
. ã‚¹ãƒ†ãƒƒãƒ— *pentesting-test* ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
Web ã‚¹ã‚­ãƒ£ãƒŠ https://www.zaproxy.org/[OWASP Zap Proxy] ã‚’ç”¨ã„ã¦ã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’ç”¨ã„ãŸãƒšãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ï¼ˆ*ãƒšãƒ³ãƒ†ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ*ï¼‰ã€å¯èƒ½æ€§ã®ã‚ã‚‹è„†å¼±æ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚Zap Proxyã®ãƒ¬ãƒãƒ¼ãƒˆãŒãƒ¬ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚
çµæœã¯ãƒ­ã‚°ã®æœ€ä¸‹è¡Œã‹ã‚‰ã”è¦§ãã ã•ã„ã€‚
+
[æ³¨æ„] ``Internal Server Error`` ã§ã€ãƒ¬ãƒãƒ¼ãƒˆãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¦ã„ãªã„å ´åˆã€ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã® https://github.com/RH-OPEN/SecurityDemos/blob/master/2021Labs/OpenShiftSecurity/documentation/lab4.adoc#%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%B8%E3%81%AEzap%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AB%E5%A4%B1%E6%95%97%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F[ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã¸ã®zapãƒ—ãƒ­ã‚­ã‚·ãƒ¬ãƒãƒ¼ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ] ã«å¾“ã£ã¦ã€curlã‚³ãƒãƒ³ãƒ‰ã‚’ä¿®æ­£ã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã—ã¦ä¸‹ã•ã„ã€‚
+
image:cicd/lab4-devsecops72.png[300,700]
+
. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆãŒãƒ¬ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚
.. å·¦å´ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã® `Route` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`reports-repo` ã®ãƒ«ãƒ¼ãƒˆãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops73.png[300,700]
+
.. ãƒªãƒ³ã‚¯ã¯ã€PipelineRun ã®åå‰ã«å¯¾å¿œã—ãŸåå‰ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
.. PipelineRun ã¨åŒã˜åç§°ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚åŒæ§˜ã®ãƒªãƒ³ã‚¯ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
+
image:cicd/lab4-devsecops75.png[300,400]
+
.. ãƒ«ãƒ¼ãƒˆã®å ´æ‰€ã®ä¸‹ã«ã‚ã‚‹ petclinic-build-dev-XXXX.html ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚
+
image:cicd/lab4-devsecops76.png[300,700]
+
. ä¸¦è¡Œã—ã¦ã€è² è·ãƒ†ã‚¹ãƒˆ https://gatling.io/[Gatling] ã‚’ä½¿ã£ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œã‹ã‚‰ "performance-test" ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops77.png[300,700]
+
.. ãƒ¬ãƒãƒ¼ãƒˆã®å ´æ‰€ã‚’è¦‹ã‚‹ã«ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ãã ã•ã„
+
image:cicd/lab4-devsecops78.png[300,700]
+
.. ãƒ¬ãƒãƒ¼ãƒˆã®ãƒ¬ãƒã®å ´æ‰€ã«æˆ»ã‚Šã¾ã™:
+
image:cicd/lab4-devsecops79.png[300,400]
+
.. Pipeline Runã®åå‰ã«ä¸€è‡´ã™ã‚‹ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`performance-test` ã‚¿ã‚¹ã‚¯ãƒ­ã‚°ã«ã‚‚è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ "addvisitsimulation" ã«å¯¾å¿œã™ã‚‹ãƒªãƒ³ã‚¯ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops80.png[200,400]
+
.. ä¸‹ã®ç”»åƒã®ã‚ˆã†ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ã€‚
+
image:cicd/lab4-devsecops81.png[400,700]

[#policy_violation]
== ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã¨CIã«ã¤ã„ã¦

ã“ã®ãƒ‡ãƒ¢ã§ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®åˆ¶å¾¡ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¹ã‚­ãƒ£ãƒ³ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ä½¿ç”¨ã•ã‚Œã‚‹ã•ã¾ã–ã¾ãªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®åˆ†æãŒå¯èƒ½ã§ã™ã€‚ +
ACSã§ç•°ãªã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ã—ã€ã“ã®ãƒãƒªã‚·ãƒ¼é•åãŒDevSecOpsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å„ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆã‚¹ãƒ†ãƒƒãƒ— â€œimage-checkâ€, â€œimage-scanâ€, â€œdeploy-checkâ€) ã«ç¾ã‚Œã‚‹ã¨CIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å¤±æ•—ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ 

* `waffle icon` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ `Red Hat Advanced Cluster Security for Kubernetes` ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops43.png[300,300]
+
* ACS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« admin/stackrox ã¨ã„ã†ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚
+
image:cicd/lab4-devsecops82.png[300,700]
+
* Platform Configuration â†’ Policies ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops83.png[200,200]
+
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã¯ã€BUILDãƒ¬ãƒ™ãƒ«ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰/ãƒ—ãƒƒã‚·ãƒ¥æ™‚ï¼‰ã€ã¾ãŸã¯DEPLOYMENTãƒ¬ãƒ™ãƒ«ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é˜»æ­¢ã™ã‚‹ï¼‰ã§å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* ``Red Hat Package Manager in Image`` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops84.png[300,700]
+
ä¾‹ãˆã°ã€ã“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ¡ãƒ¼ã‚¸ã«RHãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼ˆdnfã€yumï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã«RHãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œå‡ºã™ã‚‹ã¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’FAILã«ã—ã¾ã™ã€‚
* ãƒãƒªã‚·ãƒ¼ã®å†…å®¹ã¯å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ã€ãƒãƒªã‚·ãƒ¼ã¨ãã®ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§å®šç¾©ã•ã‚Œã¾ã™ã€‚ãƒãƒªã‚·ãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCIã‚’åˆ¶å¾¡ã—ã¦å¤±æ•—ã¾ãŸã¯åˆæ ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
+
image:cicd/lab4-devsecops85.png[300,700]
+
* `Actions` -> `Edit policy` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* `Policy details` ã® `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ 
* ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ–¹æ³•ã¯ `Inform and enforce` ã‚’é¸æŠã—ã¾ã™ã€‚
* ãƒ“ãƒ«ãƒ‰æ™‚ `Enforce on Build` ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops87.png[300,700]
+
* `Next`, `Next`, `Next` ãã—ã¦ `Save` ã¨é †ç•ªã«ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãŒãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Œå…¨ã«åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚å®šç¾©ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’è¶…ãˆã‚‹Imageã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚Šã€ã‚¯ãƒ©ã‚¹ã‚¿ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚


[#fiximage]
== ãƒœãƒ¼ãƒŠã‚¹ãƒ©ãƒœï¼šImage ã‚’ä¿®æ­£ã™ã‚‹

``bad image``ã®ãƒ“ãƒ«ãƒ‰ã«å¼·åˆ¶åˆæ ¼ã™ã‚‹Imageã¸ã®ç§»è¡Œã‚’ç¤ºã›ã‚‹ã€å®Œå…¨ãªãƒ‡ãƒ¢ã®ãŸã‚ã«ã€Image ãƒ“ãƒ«ãƒ‰ã®Tektonã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ã—ã€Imageã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã®ä¾‹ã§ã¯ã€ACS ã§ ``Red Hat Package Manager in Image`` ãƒãƒªã‚·ãƒ¼ã®å®Ÿæ–½ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã« yum ã¨ rpm ã®ä¸¡æ–¹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ãŸã‚ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå¤±æ•—ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

. å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è¡Œã£ãŸã‚ˆã†ã«ã€*Fixable Severity at least important* ãƒãƒªã‚·ãƒ¼ã§é•åã‚’å›é¿ã™ã‚‹ä¾‹å¤–ã‚’è¿½åŠ ã—ã¾ã™ã€‚
. *Red Hat Package Manager in Image* ãƒãƒªã‚·ãƒ¼ã®å®Ÿæ–½ã‚’æœ‰åŠ¹ã«ã—ã¾ã™:
.. `Platform Configuration` â†’ `Policies` ã«ç§»å‹•ã—ã¾ã™ã€‚
.. `Red Hat Package Manager in Image` ã®ãƒãƒªã‚·ãƒ¼ã‚’æ¤œç´¢ã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops88.png[300,700]
+
.. `Red Hat Package Manager in Image` policy ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `Actions` -> `Edit policy` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `Inform and enforce` ã‚’é¸æŠã—ã¾ã™ã€‚
.. `Configure enforcement behavior` ã® Build ã§ `Enforce on Build` ã‚’é¸æŠã—ã€ç¢ºèªã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops87.png[300,600]
+
.. `Next` ã‚’ç¶šã‘ã¦ã‚¯ãƒªãƒƒã‚¯ã— `Review policy` ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚
.. `Save` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™(å¤‰æ›´ãŒã‚ã‚‹å ´åˆ)ã€‚
.. OpenShift Dev UI ã‚’é–‹ãã€å·¦å´ã® Pipelines ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ `petclinic-build-dev` pipeline ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ å³ä¸Šã® Actions ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ `Start last run` ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:cicd/lab4-devsecops91.png[300,700]
+
.. ã‚¤ãƒ¡ãƒ¼ã‚¸ã«"rpm"ã¨"yum"ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€**image-check**ã‚¹ãƒ†ãƒƒãƒ—ã§å¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ç¢ºèªã—ã¾ã™ã€‚**image-check**ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰ã®ææ¡ˆã«æ³¨ç›®ã—ã¦ãã ã•ã„:
+
image:cicd/lab4-devsecops92.png[300,700]
+
.. ã“ã®æ”¹å–„æ¡ˆã§åŠ¹æœçš„ã« Image ã‚’æ›´æ–°ã—ã¦ã„ãã¾ã™ã€‚
. Tekton ã‚¿ã‚¹ã‚¯ `s2i-java-11` ã‚’æ›´æ–°ã™ã‚‹ã®ã§ã¯ãªãã€ã‚¿ã‚¹ã‚¯ã‚’ç½®ãæ›ãˆã¾ã™ã€‚
.. OpenShift Administrator UIã‹ã‚‰ã€ocp-workshopãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã€Pipelines > Tasksã«ç§»å‹•ã—ã€s2i-java-11ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚
+
image:cicd/lab4-devsecops93.png[300,700]
+
.. ã¾ãŸã¯ã€Tekton cli ã§
+
|===
|tkn task delete s2i-java-11
|===
+
. ã‚³ãƒãƒ³ãƒ‰ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰æ–°ã—ã„æ›´æ–°ã‚¿ã‚¹ã‚¯ã‚’é©ç”¨ã—ã¾ã™:
+
|===
|kubectl apply -f https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml --namespace=ocp-workshop
|ã¾ãŸã¯
|oc apply -f https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml  -n ocp-workshop
|===
+
. OpenShift Dev UI ã‚’é–‹ãã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸã€‚developersã®çš†ã•ã‚“ã€ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™!
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
+
image:cicd/lab4-bonus-result.png[300,700]
+
[æ³¨æ„] https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml[*labs-artifacts/s2ijava-mgr.yaml]*** **ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ã©ã®ã‚ˆã†ã«ImageãŒä¿®æ­£ã•ã‚ŒãŸã‹ã®è©³ç´°ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€ã”ç¢ºèªãã ã•ã„ã€‚ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯ã«ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½åŠ ã—ã€buildahã‚’æ´»ç”¨ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™(ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ "rpm" or "yum" ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„)ã€‚
+
image:cicd/lab4-devsecops94.png[300,700]

== ãƒœãƒ¼ãƒŠã‚¹ãƒ©ãƒœ: CVEã‚’ä¸€æ™‚çš„ã«ã‚¹ãƒŒãƒ¼ã‚ºã™ã‚‹

ã‚‚ã—ã€Imageã‚’ä¿®æ­£ã—ãŸã‚Šã€ãƒ“ãƒ«ãƒ‰ã®ãƒãƒªã‚·ãƒ¼ã«ä¾‹å¤–ã‚’è¿½åŠ ã™ã‚‹ä»£ã‚ã‚Šã«ã€ç‰¹å®šã®CVEsã‚’ã‚¹ãƒŒãƒ¼ã‚ºã—ãŸã„ã ã‘ãªã‚‰ã€‚ACSã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€å®šæœŸé–“ã€CVEã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

[æ³¨æ„] CVEs ã‚’ã‚¹ãƒŒãƒ¼ã‚ºã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒãƒªã‚·ãƒ¼ã§ CVEs ãŒä¸€æ™‚çš„ã«ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒ©ãƒœã§ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã™ã‚‹åŸå› ã¨ãªã‚‹ CVE ã‚’ã‚¹ãƒŒãƒ¼ã‚ºã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰ã‚’ç¶šè¡Œã—ã¾ã™ã€‚image-checkã‚¿ã‚¹ã‚¯ãŒãƒ­ã‚°ã‹ã‚‰é•åæƒ…å ±ã‚’å ±å‘Šã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚


image:cicd/lab4-devsecops95.png[300,700]

çŠ¶æ³ã«ã‚ˆã£ã¦ã¯ã€CVE ã‚’ä¸€å®šæœŸé–“ã‚¹ãƒŒãƒ¼ã‚ºã•ã›ãŸã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯ãã®æ‰‹é †ã§ã™:

.  `waffle icon` ã‹ã‚‰ACSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ç§»å‹•ã—ã€`Red Hat Advanced Clustered Security for Kubernetes` ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®Vulnerability Managementã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä¸Šéƒ¨ã«ã‚ã‚‹CVEsãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
. ã‚¹ãƒŒãƒ¼ã‚ºã™ã‚‹CVEã‚’æ¢ã—ã€å¿…è¦ãªæœŸé–“ã‚’é¸æŠã—ã¦ã‚¹ãƒŒãƒ¼ã‚ºã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
+
image:cicd/lab4-devsecops96.png[300,700]

[#troubleshooting]
== ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

=== ã‚³ãƒ¼ãƒ‰åˆ†æã®å¤±æ•—

- èª²é¡Œ:
mvn ãŒ maven install 'sonar:sonar' ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã¨ãã«ã€Code Analysis ãŒã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™ã“ã¨ãŒã‚ã‚Šã¾ã™:

[source]
----
[[1;31mERROR[m] Failed to execute goal+
[32morg.apache.maven.plugins:maven-compiler-plugin:3.8.1:testCompile[m [1m(default-testCompile)[m on
project [36mspring-petclinic[m: [1;31mCompilation failure[m
[[1;31mERROR[m]
[1;31m/workspace/source/spring-petclinic/src/test/java/org/springframework/samples/petclinic/service/ClinicServiceTests.java:[30,51]
cannot access org.springframework.samples.petclinic.owner.Pet[m
[[1;31mERROR[m] [1;31m  bad class file:
/workspace/source/spring-petclinic/target/classes/org/springframework/samples/petclinic/owner/Pet.class[m
[[1;31mERROR[m] [1;31m    class file contains wrong class:
org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest[m
[[1;31mERROR[m] [1;31m    Please remove or make sure it appears in the correct subdirectory of the
classpath.[m
[[1;31mERROR[m] [1;31m[m
[[1;31mERROR[m] -> [1m[Help 1][m
[[1;31mERROR[m]
----

- è§£æ±ºæ–¹æ³•:
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã™ã‚Œã°ã€è¿½åŠ ã§ä½•ã‹ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãæˆåŠŸã—ã¾ã™ã€‚ãã®å¾Œã€çµæœã¯æˆåŠŸã—ã¾ã™:
[source]
----
[[1;34mINFO[m] Analyzed bundle 'petclinic' with 20 classes+
[[1;34mINFO[m] Analyzed bundle 'petclinic' with 20 classes
[[1;34mINFO[m]
[[1;34mINFO[m] [1m--- [0;32mmaven-jar-plugin:3.1.2:jar[m [1m(default-jar)[m @
[36mspring-petclinic[0;1m ---[m
[[1;34mINFO[m]
[[1;34mINFO[m] [1m--- [0;32mspring-boot-maven-plugin:2.2.5.RELEASE:repackage[m [1m(repackage)[m @
[36mspring-petclinic[0;1m ---[m
[[1;34mINFO[m] Replacing main artifact with repackaged archive
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1;32mBUILD SUCCESS[m
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] Total time: 01:55 min
[[1;34mINFO[m] Finished at: 2021-07-23T07:37:09Z
[[1;34mINFO[m] Final Memory: 118M/1245M
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
----

=== JUnit ãƒ†ã‚¹ãƒˆã®å¤±æ•—

ã‚³ãƒ¼ãƒ‰è§£æã‚’å‚ç…§ã€‚å†å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ãŒä¿®æ­£ã•ã‚Œã¾ã™ã€‚

===  ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã¸ã®zapãƒ—ãƒ­ã‚­ã‚·ãƒ¬ãƒãƒ¼ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚


zap proxy ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚ŒãŸå¾Œã€é–“é•ã£ãŸãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã®ãŸã‚ã«ãƒ¬ãƒãƒ¼ãƒˆãƒªãƒã‚µãƒ¼ãƒã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã™ã‚‹:
[source]
----
+ ls -lhrt /zap/wrk
total 76K

-rw-r--r--. 1 zap zap 75K Aug 20 10:41 petclinic-build-devm9hqv.html
+ echo 'Uploading the report into the report server'
Uploading the report into the report server

+ curl -u reports:reports -F path=petclinic-build-devm9hqv.html -F file=/zap/wrk/petclinic-build-devm9hqv.html -X POST http://reports-repo:8080/upload
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
100   335  100    36  100   299   7200  59800 --:--:-- --:--:-- --:--:-- 67000
{"message":"Internal Server Error"}
----

zap-proxyã‚¿ã‚¹ã‚¯ã‚’ä¿®æ­£ã—ã€99è¡Œç›®ã‚’ä»¥ä¸‹ã® curl ã®å†…å®¹ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã§ã€æ­£ã—ãã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
[source]
----
curl -u $(params.REPORTS_REPO_USERNAME):$(params.REPORTS_REPO_PASSWORD) -F path=$PIPELINERUN_NAME/$PIPELINERUN_NAME.html -F file=@/zap/wrk/$PIPELINERUN_NAME.html -X POST $(params.REPORTS_REPO_HOST)/upload; echo ""
----

ãã®å¾Œã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã—ã€åŠ¹æœçš„ã«zapãƒ—ãƒ­ã‚­ã‚·ãƒ¬ãƒãƒ¼ãƒˆãŒãƒ¬ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™:
[source]
----
+ curl -u reports:reports -F path=petclinic-build-dev-6f4569/petclinic-build-dev-6f4569.html -F file=@/zap/wrk/petclinic-build-dev-6f4569.html -X POST http://reports-repo:8080/upload
% Total % Received % Xferd Average Speed Time Time Time Current
Dload Upload Total Spent Left Speed

0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0
100 76435 100 89 100 76346 22250 18.2M --:File has been uploaded to petclinic-build-dev-6f4569/petclinic-build-dev-6f4569.html ğŸš€--:-- --:--:-- --:--:-- 18.2M
+ echo ''
----

image:cicd/lab4-devsecops100.png[300,700]